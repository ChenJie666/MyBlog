---
title: Protobuf编程
categories:
- 编程语言
---
#简介：
Protobuf全称是GoogleProtocolBuffer,是一种高效轻便的结构化数据存储方式,可用于(数据)通信协议、数据存储等。Protobuf是一种二进制格式的文件。

#二进制文件和文本文件的区别：
        读取过程包括磁盘 -> 文件缓冲区->应用程序内存空间这两个转化过程。“文本文件和二进制文件没有区别”，实际上针对的是第一个过程；区别实际上是第二个过程造成的。文件实际上包括两部分，控制信息和内容信息。文本文件实际上的解释格式已经确定了：ASCII或者unicode编码。文本文件中的一个数字65536，需要用5个字节来存储；但是用二进制格式，采用int存储，仅仅需要2个字节。而二进制文件elf和bmp等，都往往有一个head，告诉你文件信息和解释方式。
        记事本支持文本文件而不支持二进制文件，所以如果你用记事本打开文本文件那么一切正常，如果打开的是二进制文件就会出现乱码。但也有不乱码的地方，你会注意到那些地方都是字符编码的，而对于int、double等类型所对应的值都是乱码的，这是由于记事本只能够识别字符类型，而无法识别其他类型。文本文件编码基于字符定长，译码容易些；二进制文件编码是变长的，所以它灵活，存储利用率要高些，译码难一些（不同的二进制文件格式，有不同的译码方式）。
1、二进制文件是把内存中的数据按其在内存中的存储形式原样输出到磁盘上存放，也就是说存放的是数据的原形式。
2、文本文件是把数据的终端形式的二进制数据输出到磁盘上存放，也就是说存放的是数据的终端形式。
        为什么用二进制：第一是二进制文件比较节约空间，这两者储存字符型数据时并没有差别。但是在储存数字，特别是实型数字时，二进制更节省空间；第二个原因是，内存中参加计算的数据都是用二进制无格式储存起来的，因此，使用二进制储存到文件就更快捷。如果储存为文本文件，则需要一个转换的过程。在数据量很大的时候，两者就会有明显的速度差别了。第三，就是一些比较精确的数据，使用二进制储存不会造成有效位的丢失。 
       protobuf存储int32或int64时，所占的字节数为1-5或1-9个，因为protobuf存储时动态调整大小，而且每个字节的最高位为符号位标识是否还有更高位的数字。
```java
public void writeRawVarint32(int value) throws IOException{
  while(true){
    if((value & ~0x7F) == 0){
      writeRawByte(value);
      return;
    }else{
      writeRawByte((value & 0x7F) | 0x80);    //如果一个字符装不下，进入此else并将最高位符号位置为1
      value >>>= 7;  
    }
  }
}
```
