---
title: MySQL与Redis和ES进行数据同步
categories:
- 中间件
---
**同步Redis：**
1. MySQL进行新增操作时，不需要对Redis进行操作；
2. MySQL进行更新、删除操作时，在同一个线程中先对Redis进行操作，然后对MySQL进行操作，最后通过maxwell监控binlog文件再次对redis进行异步删除操作。

<br>
**mysql与redis缓存一致性问题**
场景：线程A，修改数据，线程B使用数据。

1、双删策略：线程A写数据时，先删除redis的数据，然后修改mysql，之后再删除redis的数据。
问题：线程A在修改mysql的时候，线程B先读取了数据，接着线程A执行完毕，此时redis中没有数据了，接着线程B处理业务然后设置redis缓存，此时redis中的数据还是线程A修改前的数据。

2、延迟双删策略：线程A写数据时，先删除redis的数据，然后修改mysql，之后再延迟一个业务时间后删除redis的数据。
问题：该策略无法包括这个延迟时间；并且会影响系统的处理能力。

3、读写串行化：只要读和写是并发产生的就必然会存在，数据一致性问题。如果要彻底解决该问题，就要串行。该中方式会影响效率，如果采用可以做好压力测试。
使用分布式锁：影响效率
使用队列：将操作同一资源的请求，打到同一个队列中。

4、cancel：同步mysql的bin_log ，更新redis。该方式也会存在延迟。

5、redis 设置失效时间

<br>
**同步ES：**
1. 监控MySQL的binlog，通过MQ异步对ES进行同步操作。
