<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ELK配合Filebeat完成日志采集 | Hexo</title><meta name="author" content="CJ"><meta name="copyright" content="CJ"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一、组件介绍1.1 FilebeatFilebeat是本地文件的日志数据采集器，可监控日志目录或特定日志文件（tail file），并将它们转发给Elasticsearch或Logstatsh进行索引、kafka等。带有内部模块（auditd，Apache，Nginx，System和MySQL），可通过一个指定命令来简化通用日志格式的收集，解析和可视化。 Filebeat涉及两个组件：查找器pro">
<meta property="og:type" content="article">
<meta property="og:title" content="ELK配合Filebeat完成日志采集">
<meta property="og:url" content="http://example.com/2023/05/06/ELK/ELK%E9%85%8D%E5%90%88Filebeat%E5%AE%8C%E6%88%90%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="一、组件介绍1.1 FilebeatFilebeat是本地文件的日志数据采集器，可监控日志目录或特定日志文件（tail file），并将它们转发给Elasticsearch或Logstatsh进行索引、kafka等。带有内部模块（auditd，Apache，Nginx，System和MySQL），可通过一个指定命令来简化通用日志格式的收集，解析和可视化。 Filebeat涉及两个组件：查找器pro">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png">
<meta property="article:published_time" content="2023-05-06T05:31:21.015Z">
<meta property="article:modified_time" content="2023-05-06T05:31:21.015Z">
<meta property="article:author" content="CJ">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2023/05/06/ELK/ELK%E9%85%8D%E5%90%88Filebeat%E5%AE%8C%E6%88%90%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ELK配合Filebeat完成日志采集',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-05-06 13:31:21'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">419</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">38</div></a></div><hr/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Hexo"><span class="site-name">Hexo</span></a></span><div id="menus"><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ELK配合Filebeat完成日志采集</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-05-06T05:31:21.015Z" title="发表于 2023-05-06 13:31:21">2023-05-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-05-06T05:31:21.015Z" title="更新于 2023-05-06 13:31:21">2023-05-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ELK/">ELK</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ELK配合Filebeat完成日志采集"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="一、组件介绍"><a href="#一、组件介绍" class="headerlink" title="一、组件介绍"></a>一、组件介绍</h1><h2 id="1-1-Filebeat"><a href="#1-1-Filebeat" class="headerlink" title="1.1 Filebeat"></a>1.1 Filebeat</h2><p>Filebeat是本地文件的日志数据采集器，可监控日志目录或特定日志文件（tail file），并将它们转发给Elasticsearch或Logstatsh进行索引、kafka等。带有内部模块（auditd，Apache，Nginx，System和MySQL），可通过一个指定命令来简化通用日志格式的收集，解析和可视化。</p>
<p>Filebeat涉及两个组件：查找器prospector和采集器harvester，来读取文件(tail file)并将事件数据发送到指定的输出。</p>
<p>启动Filebeat时，它会启动一个或多个查找器prospector，查看你为日志文件指定的本地路径。对于prospector所在的每个日志文件，prospector启动采集器harvester。每个harvester都会为新内容读取单个日志文件，并将新日志数据发送到libbeat，后者将聚合事件并将聚合数据发送到Filebeat配置的输出。</p>
<p>ELK是Logstash、Elasticsearch、Kibana三大开源框架首字母大写简称。</p>
<h2 id="1-2-Logstash"><a href="#1-2-Logstash" class="headerlink" title="1.2 Logstash"></a>1.2 Logstash</h2><p>![1585818645361.png](ELK配合Filebeat完成日志采集.assets6693d117b7f40a4a95715ef285e31ba.png)</p>
<p>Logstash是一个数据分析软件，主要目的是分析log日志。如上图所示，Logstash主要分为三个部分，input、filter和output（input：设置数据来源 ; filter：可以对数据进行一定的加工处理过滤 ; output：设置输出目标）</p>
<p>filter是logstash功能强大的原因，filter的插件介绍：</p>
<p><strong>①grok</strong></p>
<p>grok模式的语法如下：</p>
<p><strong>%{SYNTAX:SEMANTIC}</strong></p>
<p>SYNTAX：代表匹配值的类型,例如3.44可以用NUMBER类型所匹配,127.0.0.1可以使用IP类型匹配。  SEMANTIC：代表存储该值的一个变量名称,例如 3.44 可能是一个事件的持续时间,127.0.0.1可能是请求的client地址。所以这两个值可以用 %{NUMBER:duration} %{IP:client} 来匹配，IPORHOST、HTTPDATE等是封装过的正则表达式，直接使用即可，无需自己再写。。</p>
<p>也可以选择将数据类型转换添加到Grok模式。默认情况下，所有语义都保存为字符串。如果想转换成默认的数据类型，可以%{NUMBER:num:int}将num语义从一个字符串转换为一个整数。目前唯一支持的转换是int和float。</p>
<figure class="highlight plaintext"><figcaption><span>&#123;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> # 解析日志生成相关的IP，访问地址，日志级别</span><br><span class="line"> grok &#123;</span><br><span class="line"> match =&gt; &#123; </span><br><span class="line"> &quot;message&quot; =&gt; &quot;%&#123;SYSLOG5424SD:time&#125; %&#123;IP:hostip&#125; %&#123;URIPATHPARAM:url&#125;\s*%&#123;LOGLEVEL:loglevel&#125;&quot; </span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> #解析log生成的时间为时间戳</span><br><span class="line"> grok&#123;</span><br><span class="line"> match =&gt; &#123;</span><br><span class="line"> &quot;message&quot; =&gt; &quot;%&#123;TIMESTAMP_ISO8601:log_create_date&#125;&quot;</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>②geoip</strong></p>
<p>根据ip地址获取经纬度，国家，城市，地区等信息。</p>
<p>wget <a target="_blank" rel="noopener" href="http://geolite.maxmind.com/download/geoip/database/GeoLite2-City.tar.gz">http://geolite.maxmind.com/download/geoip/database/GeoLite2-City.tar.gz</a></p>
<p>tar -zxvf GeoLite2-City.tar.gz</p>
<p>cp GeoLite2-City.mmdb &#x2F;data&#x2F;logstash&#x2F;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">filter &#123;</span><br><span class="line"> geoip &#123;</span><br><span class="line"> source =&gt; &quot;message&quot;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">output&#123;stdout&#123;codec=&gt;rubydebug&#125;&#125;</span><br><span class="line"></span><br><span class="line">#输入：183.60.92.253</span><br><span class="line">#输出：</span><br><span class="line">&#123;</span><br><span class="line"> &quot;type&quot; =&gt; &quot;std&quot;,</span><br><span class="line"> &quot;@version&quot; =&gt; &quot;1&quot;,</span><br><span class="line"> &quot;@timestamp&quot; =&gt; 2019-03-19T05:39:26.714Z,</span><br><span class="line"> &quot;host&quot; =&gt; &quot;zzc-203&quot;,</span><br><span class="line"> &quot;message&quot; =&gt; &quot;183.60.92.253&quot;,</span><br><span class="line"> &quot;geoip&quot; =&gt; &#123;</span><br><span class="line"> &quot;country_code3&quot; =&gt; &quot;CN&quot;,</span><br><span class="line"> &quot;latitude&quot; =&gt; 23.1167,</span><br><span class="line"> &quot;region_code&quot; =&gt; &quot;44&quot;,</span><br><span class="line"> &quot;region_name&quot; =&gt; &quot;Guangdong&quot;,</span><br><span class="line"> &quot;location&quot; =&gt; &#123;</span><br><span class="line"> &quot;lon&quot; =&gt; 113.25,</span><br><span class="line"> &quot;lat&quot; =&gt; 23.1167</span><br><span class="line"> &#125;,</span><br><span class="line"> &quot;city_name&quot; =&gt; &quot;Guangzhou&quot;,</span><br><span class="line"> &quot;country_name&quot; =&gt; &quot;China&quot;,</span><br><span class="line"> &quot;continent_code&quot; =&gt; &quot;AS&quot;,</span><br><span class="line"> &quot;country_code2&quot; =&gt; &quot;CN&quot;,</span><br><span class="line"> &quot;timezone&quot; =&gt; &quot;Asia/Shanghai&quot;,</span><br><span class="line"> &quot;ip&quot; =&gt; &quot;183.60.92.253&quot;,</span><br><span class="line"> &quot;longitude&quot; =&gt; 113.25</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line"> geoip &#123;</span><br><span class="line"> source =&gt; &quot;http_x_forwarded_for&quot;  # 取自nginx中的客户端ip</span><br><span class="line"> target =&gt; &quot;geoip&quot;</span><br><span class="line"> database =&gt; &quot;/data/logstash/GeoLite2-City.mmdb&quot;</span><br><span class="line"> add_field =&gt; [ &quot;[geoip][coordinates]&quot;, &quot;%&#123;[geoip][longitude]&#125;&quot; ]</span><br><span class="line"> add_field =&gt; [ &quot;[geoip][coordinates]&quot;, &quot;%&#123;[geoip][latitude]&#125;&quot; ]</span><br><span class="line"> &#125;</span><br><span class="line"> mutate &#123;</span><br><span class="line"> convert =&gt; [ &quot;[geoip][coordinates]&quot;, &quot;float&quot; ]</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>③mutate</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">filter &#123;</span><br><span class="line"> mutate &#123;</span><br><span class="line"> #将字段的值转换为其他类型，例如将字符串转换为整数。如果字段值是数组，则将转换所有成员。</span><br><span class="line"> convert =&gt; &#123;</span><br><span class="line"> &quot;fieldname&quot; =&gt; &quot;integer&quot;</span><br><span class="line"> &quot;booleanfield&quot; =&gt; &quot;boolean&quot;</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> mutate &#123;</span><br><span class="line"> #将现有字段复制到另一个字段。将覆盖现有目标字段。</span><br><span class="line"> copy =&gt; &#123; &quot;source_field&quot; =&gt; &quot;dest_field&quot; &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> mutate &#123;</span><br><span class="line"> #使用分隔符将字段拆分为数组</span><br><span class="line"> split =&gt; &#123; &quot;fieldname&quot; =&gt; &quot;,&quot; &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>④date</strong></p>
<figure class="highlight plaintext"><figcaption><span>&#123;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> # 将log_create_date日期解析为指定格式，并将@timestamp字段替换为该日期</span><br><span class="line"> date &#123;</span><br><span class="line"> match =&gt; [ &quot;log_create_date&quot;, &quot;yyyy-MM-dd HH:mm:ss&quot; ]</span><br><span class="line"> target =&gt; &quot;@timestamp&quot; </span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>⑤useragent</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">filter &#123;</span><br><span class="line"> if [user_ua] != &quot;-&quot; &#123;</span><br><span class="line"> useragent &#123;</span><br><span class="line"> target =&gt; &quot;agent&quot;   #agent将过来出的user agent的信息配置到了单独的字段中</span><br><span class="line"> source =&gt; &quot;user_ua&quot;   #这个表示对message里面的哪个字段进行分析</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>⑥ruby脚本</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">filter &#123;</span><br><span class="line"> #利用ruby代码来动态修改logstash event</span><br><span class="line"> ruby &#123;</span><br><span class="line"> # Cancel 90% of events</span><br><span class="line"> path =&gt; &quot;/mnt/elastic/logstash-6.5.1/config/test.rb&quot;</span><br><span class="line"> # script_params =&gt; &#123; &quot;message&quot; =&gt; &quot;%&#123;message&#125;&quot; &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> json &#123;</span><br><span class="line"> source =&gt; &quot;json&quot;</span><br><span class="line"> remove_field =&gt; [&quot;json&quot;,&quot;message&quot;]</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>⑦dissect：分隔符解析</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">filter &#123;</span><br><span class="line"> dissect &#123;</span><br><span class="line"> mapping =&gt; &#123;</span><br><span class="line"> &quot;message&quot; =&gt; &quot;%&#123;ts&#125; %&#123;+ts&#125; %&#123;+ts&#125; %&#123;src&#125; %&#123;&#125; %&#123;prog&#125;[%&#123;pid&#125;]: %&#123;msg&#125;&quot;</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Dissect过滤器是一种拆分操作。与常规拆分操作(其中一个分隔符应用于整个字符串)不同，此操作将一组分隔符应用于字符串值。Dissect不使用正则表达式，速度非常快。</p>
<p>语法解释<br>我们看到上面使用了和Grok很类似的%{}语法来表示字段，这显然是基于习惯延续的考虑。不过示例中%{+ts}的加号就不一般了。dissect 除了字段外面的字符串定位功能以外，还通过几个特殊符号来处理字段提取的规则：</p>
<p>%{+key}这个+表示，前面已经捕获到一个key字段了，而这次捕获的内容，自动添补到之前 key 字段内容的后面。<br>%{+key&#x2F;2}这个&#x2F;2表示，在有多次捕获内容都填到 key字段里的时候，拼接字符串的顺序谁前谁后。&#x2F;2表示排第2位。<br>%{}是一个空的跳过字段。<br>%{?string}这个?表示，这块只是一个占位，并不会实际生成捕获字段存到事件里面。<br>%{?string} %{&amp;string}当同样捕获名称都是string，但是一个?一个&amp;的时候，表示这是一个键值对。<br>填充符<br>字段的-&gt;后缀例如%{function-&gt;}，表示忽略它右边的填充，否则右边的多余填充将拆分到下一个字段中。</p>
<h2 id="1-3-Elasticsearch"><a href="#1-3-Elasticsearch" class="headerlink" title="1.3 Elasticsearch"></a>1.3 Elasticsearch</h2><p> Elasticsearch是一个开源的分布式、RESTful 风格的搜索和数据分析引擎，它的底层是开源库Apache Lucene。Lucene是当下最先进、高性能、全功能的搜索引擎库。为了解决Lucene使用时的繁复性，Elasticsearch对其进行了封装，内部采用 Lucene 做索引与搜索，提供了一套简单一致的 RESTful API 来帮助我们实现存储和检索。    当然，Elasticsearch 不仅仅是 Lucene，并且也不仅仅只是一个全文搜索引擎。 它可以被下面这样准确地形容：</p>
<ul>
<li><p>一个分布式的实时文档存储，每个字段可以被索引与搜索；</p>
</li>
<li><p>一个分布式实时分析搜索引擎；</p>
</li>
<li><p>能胜任上百个服务节点的扩展，并支持 PB 级别的结构化或者非结构化数据。</p>
</li>
</ul>
<p>由于Elasticsearch的功能强大和使用简单，维基百科、卫报、Stack Overflow、GitHub等都纷纷采用它来做搜索。现在，Elasticsearch已成为全文搜索领域的主流软件之一。</p>
<h2 id="1-4-Kibana"><a href="#1-4-Kibana" class="headerlink" title="1.4 Kibana"></a>1.4 Kibana</h2><p>Kibana 是为 Elasticsearch设计的开源分析和可视化平台。你可以使用 Kibana 来搜索，查看存储在 Elasticsearch 索引中的数据并与之交互。你可以很容易实现高级的数据分析和可视化，以图标的形式展现出来。</p>
<p><strong>实时监控</strong>：通过 histogram 面板，配合不同条件的多个 queries 可以对一个事件走很多个维度组合出不同的时间序列走势。时间序列数据是最常见的监控报警了。  <strong>问题分析</strong>：搜索，通过下钻数据排查问题，通过分析根本原因来解决问题；实时可见性，可以将对系统的检测和警报结合在一起，便于跟踪 SLA 和性能问题；历史分析，可以从中找出趋势和历史模式，行为基线和阈值，生成一致性报告。</p>
<p><strong>总结：</strong></p>
<p>整一套软件可以当作一个MVC模型，logstash是controller层，Elasticsearch是一个model层，kibana是view层。首先将数据传给logstash，它将数据进行过滤和格式化（转成JSON格式），然后传给Elasticsearch进行存储、建搜索的索引，kibana提供前端的页面再进行搜索和图表可视化，它是调用Elasticsearch的接口返回的数据进行可视化。logstash和Elasticsearch是用Java写的，kibana使用node.js框架。</p>
<br>
# 二、总体结构

<p><img src="/ELK%E9%85%8D%E5%90%88Filebeat%E5%AE%8C%E6%88%90%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86.assets%5C1dc4641e317240e59d11a4792cfd3fcc.png" alt="1585818270028.png"></p>
<br>
# 三、准备工作
##3.1 微服务配置
添加依赖
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;net.logstash.logback&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;logstash-logback-encoder&lt;/artifactId&gt;</span><br><span class="line">     &lt;version&gt;4.10&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
在微服务classpath路径下添加logback日志框架的配置文件logback.xml
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;include resource=&quot;org/springframework/boot/logging/logback/defaults.xml&quot;/&gt;</span><br><span class="line">    &lt;springProperty scope=&quot;context&quot; name=&quot;springAppName&quot; source=&quot;spring.application.name&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 日志在工程中的输出位置 --&gt;</span><br><span class="line">    &lt;property name=&quot;LOG_FILE&quot; value=&quot;$&#123;BUILD_FOLDER:-build&#125;/$&#123;springAppName&#125;&quot;/&gt;</span><br><span class="line">    &lt;property name=&quot;SERVICE_NAME&quot; value=&quot;Smartcook&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 工程名字 --&gt;</span><br><span class="line">    &lt;contextName&gt;$&#123;SERVICE_NAME&#125;&lt;/contextName&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 控制台的日志输出样式 --&gt;</span><br><span class="line">    &lt;property name=&quot;CONSOLE_LOG_PATTERN&quot;</span><br><span class="line">              value=&quot;logback--%clr(%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;)&#123;faint&#125; %clr($&#123;LOG_LEVEL_PATTERN:-%5p&#125;) %clr($&#123;PID:- &#125;)&#123;magenta&#125; %clr(---)&#123;faint&#125; %clr([%15.15t])&#123;faint&#125; %m%n$&#123;LOG_EXCEPTION_CONVERSION_WORD:-%wEx&#125;&#125;&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 控制台输出 --&gt;</span><br><span class="line">    &lt;appender name=&quot;console&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;</span><br><span class="line">        &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt;</span><br><span class="line">            &lt;level&gt;INFO&lt;/level&gt;</span><br><span class="line">        &lt;/filter&gt;</span><br><span class="line">        &lt;!-- 日志输出编码 --&gt;</span><br><span class="line">        &lt;encoder&gt;</span><br><span class="line">            &lt;pattern&gt;$&#123;CONSOLE_LOG_PATTERN&#125;&lt;/pattern&gt;</span><br><span class="line">            &lt;charset&gt;utf8&lt;/charset&gt;</span><br><span class="line">        &lt;/encoder&gt;</span><br><span class="line">    &lt;/appender&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 日志输出为文件 --&gt;</span><br><span class="line">    &lt;!--&lt;appender name=&quot;FILE&quot; class=&quot;ch.qos.logback.core.FileAppender&quot;&gt;--&gt;</span><br><span class="line">    &lt;!--&amp;lt;!&amp;ndash; $使用变量FILE_PATH的格式,类似Linux中使用的格式：$&#123;FILE_PATH&#125; &amp;ndash;&amp;gt;--&gt;</span><br><span class="line">    &lt;!--&lt;file&gt;logs/file.log&lt;/file&gt;--&gt;</span><br><span class="line">    &lt;!--&lt;encoder&gt;--&gt;</span><br><span class="line">    &lt;!--&amp;lt;!&amp;ndash; 指定输出格式 &amp;ndash;&amp;gt;--&gt;</span><br><span class="line">    &lt;!--&lt;pattern&gt;%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;0&#125; -%msg%n&lt;/pattern&gt;--&gt;</span><br><span class="line">    &lt;!--&lt;/encoder&gt;--&gt;</span><br><span class="line">    &lt;!--&lt;/appender&gt;--&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 日志输出为文件，且每天回滚为新文件，文件保留30天 --&gt;</span><br><span class="line">    &lt;appender name=&quot;FILE&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;　　　　　　　　　　　</span><br><span class="line">        &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;　　　　　　　　　　　　　</span><br><span class="line">            &lt;fileNamePattern&gt;logs/logFile.%d&#123;yyyy-MM-dd&#125;.log&lt;/fileNamePattern&gt;　　　　　　　　　　　　</span><br><span class="line">            &lt;maxHistory&gt;30&lt;/maxHistory&gt;　</span><br><span class="line">        &lt;/rollingPolicy&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--日志文件最大的大小 --&gt;</span><br><span class="line">        &lt;triggeringPolicy</span><br><span class="line">                class=&quot;ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy&quot;&gt;</span><br><span class="line">            &lt;MaxFileSize&gt;10MB&lt;/MaxFileSize&gt;</span><br><span class="line">        &lt;/triggeringPolicy&gt;</span><br><span class="line"></span><br><span class="line">        &lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt;</span><br><span class="line">            &lt;!--格式化输出：%d表示日期，%thread表示线程名，%-5level：级别从左显示5个字符宽度%msg：日志消息，%n是换行符 --&gt;</span><br><span class="line">            &lt;pattern&gt;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level</span><br><span class="line">                %logger&#123;50&#125; - %msg %n</span><br><span class="line">            &lt;/pattern&gt;</span><br><span class="line">        &lt;/encoder&gt;</span><br><span class="line">    &lt;/appender&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--为logstash输出的Appender --&gt;</span><br><span class="line">    &lt;!--&lt;appender name=&quot;logstash&quot; class=&quot;net.logstash.logback.appender.LogstashTcpSocketAppender&quot;&gt;</span><br><span class="line">        &lt;destination&gt;192.168.32.128:5044&lt;/destination&gt;</span><br><span class="line">        &lt;encoder charset=&quot;UTF-8&quot; class=&quot;net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder&quot;&gt;</span><br><span class="line">            &lt;jsonFactoryDecorator class=&quot;net.logstash.logback.decorate.CharacterEscapesJsonFactoryDecorator&quot;&gt;</span><br><span class="line">                &lt;escape&gt;</span><br><span class="line">                    &lt;targetCharacterCode&gt;10&lt;/targetCharacterCode&gt;</span><br><span class="line">                    &lt;escapeSequence&gt; &lt;/escapeSequence&gt;</span><br><span class="line">                &lt;/escape&gt;</span><br><span class="line">            &lt;/jsonFactoryDecorator&gt;</span><br><span class="line">            &lt;providers&gt;</span><br><span class="line">                &lt;pattern&gt;</span><br><span class="line">                    &lt;pattern&gt;</span><br><span class="line">                        &#123;</span><br><span class="line">                        &quot;timestamp&quot;:&quot;%date&#123;ISO8601&#125;&quot;,</span><br><span class="line">                        &quot;user&quot;:&quot;test&quot;,</span><br><span class="line">                        &quot;message&quot;:&quot;[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;][%p][%t][%L&#123;80&#125;|%L]%m&quot;&#125;%n</span><br><span class="line">                        &#125;</span><br><span class="line">                    &lt;/pattern&gt;</span><br><span class="line">                &lt;/pattern&gt;</span><br><span class="line">            &lt;/providers&gt;</span><br><span class="line">        &lt;/encoder&gt;</span><br><span class="line">        &lt;keepAliveDuration&gt;5 minutes&lt;/keepAliveDuration&gt;</span><br><span class="line">    &lt;/appender&gt;--&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--&lt;appender name=&quot;logstash&quot; class=&quot;net.logstash.logback.appender.LogstashTcpSocketAppender&quot;&gt;--&gt;</span><br><span class="line">        &lt;!--&lt;destination&gt;192.168.32.128:5044&lt;/destination&gt;--&gt;</span><br><span class="line">        &lt;!--&lt;encoder class=&quot;net.logstash.logback.encoder.LogstashEncoder&quot; /&gt;--&gt;</span><br><span class="line">        &lt;!--&lt;keepAliveDuration&gt;5 minutes&lt;/keepAliveDuration&gt;--&gt;</span><br><span class="line">    &lt;!--&lt;/appender&gt;--&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 为logstash输出的JSON格式的Appender --&gt;</span><br><span class="line">    &lt;appender name=&quot;logstash&quot;</span><br><span class="line">              class=&quot;net.logstash.logback.appender.LogstashTcpSocketAppender&quot;&gt;</span><br><span class="line">        &lt;destination&gt;192.168.32.128:5044&lt;/destination&gt;</span><br><span class="line">        &lt;!-- 日志输出编码 --&gt;</span><br><span class="line">        &lt;encoder</span><br><span class="line">                class=&quot;net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder&quot;&gt;</span><br><span class="line">            &lt;providers&gt;</span><br><span class="line">                &lt;timestamp&gt;</span><br><span class="line">                    &lt;timeZone&gt;UTC&lt;/timeZone&gt;</span><br><span class="line">                &lt;/timestamp&gt;</span><br><span class="line">                &lt;pattern&gt;</span><br><span class="line">                    &lt;pattern&gt;</span><br><span class="line">                        &#123;</span><br><span class="line">                        &quot;level&quot;: &quot;%level&quot;,</span><br><span class="line">                        &quot;service&quot;: &quot;$&#123;springAppName:-&#125;&quot;,</span><br><span class="line">                        &quot;trace&quot;: &quot;%X&#123;X-B3-TraceId:-&#125;&quot;,</span><br><span class="line">                        &quot;span&quot;: &quot;%X&#123;X-B3-SpanId:-&#125;&quot;,</span><br><span class="line">                        &quot;exportable&quot;: &quot;%X&#123;X-Span-Export:-&#125;&quot;,</span><br><span class="line">                        &quot;pid&quot;: &quot;$&#123;PID:-&#125;&quot;,</span><br><span class="line">                        &quot;thread&quot;: &quot;%thread&quot;,</span><br><span class="line">                        &quot;class&quot;: &quot;%logger&#123;40&#125;&quot;,</span><br><span class="line">                        &quot;stack_trace&quot;: &quot;%exception&#123;30&#125;&quot;,</span><br><span class="line">                        &quot;message&quot;: &quot;%message&quot;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &lt;/pattern&gt;</span><br><span class="line">                &lt;/pattern&gt;</span><br><span class="line">            &lt;/providers&gt;</span><br><span class="line">        &lt;/encoder&gt;</span><br><span class="line">    &lt;/appender&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 日志输出级别 --&gt;</span><br><span class="line">    &lt;root level=&quot;INFO&quot;&gt;</span><br><span class="line">        &lt;appender-ref ref=&quot;console&quot;/&gt;</span><br><span class="line">        &lt;appender-ref ref=&quot;logstash&quot;/&gt;</span><br><span class="line">        &lt;appender-ref ref=&quot;FILE&quot;/&gt;</span><br><span class="line">    &lt;/root&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<p>logback在.yml文件中的配置(会每日滚动生成带有日期后缀的文件)：  logging:  level:  root: info  file: logs&#x2F;${spring.application.name}.log</p>
<h2 id="3-2-Nginx配置"><a href="#3-2-Nginx配置" class="headerlink" title="3.2 Nginx配置"></a>3.2 Nginx配置</h2><p>Nginx配置文件规定日志输出格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">log_format main &#x27;$server_name $remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">&#x27;$status $upstream_status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">&#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot; &#x27;</span><br><span class="line">&#x27;$ssl_protocol $ssl_cipher $upstream_addr $request_time $upstream_response_time&#x27;;</span><br></pre></td></tr></table></figure>
<p> 如果不经过logstash的处理，可以直接写成json格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">log_format main &#x27;&#123;&quot;server_name&quot;:&quot;$server_name&quot;,&#x27;</span><br><span class="line">                &#x27;&quot;remote_addr&quot;:&quot;$remote_addr&quot;,&#x27;</span><br><span class="line">                &#x27;&quot;remote_user&quot;:&quot;$remote_user&quot;,&#x27;</span><br><span class="line">                &#x27;&quot;time_local&quot;:&quot;$time_local&quot;,&#x27;</span><br><span class="line">                &#x27;&quot;request&quot;:&quot;$request&quot;,&#x27;</span><br><span class="line">                &#x27;&quot;status&quot;:&quot;$status&quot;,&#x27;</span><br><span class="line">                &#x27;&quot;upstream_status&quot;:&quot;$upstream_status&quot;,&#x27;</span><br><span class="line">                &#x27;&quot;body_bytes_sent&quot;:&quot;$body_bytes_sent&quot;,&#x27;</span><br><span class="line">                &#x27;&quot;http_referer&quot;:&quot;$http_referer&quot;,&#x27;</span><br><span class="line">                &#x27;&quot;http_user_agent&quot;:&quot;$http_user_agent&quot;,&#x27;</span><br><span class="line">                &#x27;&quot;http_x_forwarded_for&quot;:&quot;$http_x_forwarded_for&quot;,&#x27;</span><br><span class="line">                &#x27;&quot;ssl_protocol&quot;:&quot;$ssl_protocol&quot;,&#x27;</span><br><span class="line">                &#x27;&quot;ssl_cipher&quot;:&quot;$ssl_cipher&quot;,&#x27;</span><br><span class="line">                &#x27;&quot;upstream_addr&quot;:&quot;$upstream_addr&quot;,&#x27;</span><br><span class="line">                &#x27;&quot;request_time &quot;:&quot;$request_time&quot;,&#x27;</span><br><span class="line">                &#x27;&quot;upstream_response_time&quot;:&quot;$upstream_response_time&quot;&#x27;</span><br><span class="line">                &#x27;&#125;&#x27;;</span><br></pre></td></tr></table></figure>

<p>访问日志中一个典型的记录如下：<br>192.168.1.102 - scq2099yt [18&#x2F;Mar&#x2F;2013:23:30:42 +0800] “GET &#x2F;stats&#x2F;awstats.pl?config&#x3D;scq2099yt HTTP&#x2F;1.1” 200 899 “<a target="_blank" rel="noopener" href="http://192.168.1.1/pv/">http://192.168.1.1/pv/</a>“ “Mozilla&#x2F;4.0 (compatible; MSIE 6.0; Windows XXX; Maxthon)”</p>
<blockquote>
<p>每个样式的含义如下：<br>$server_name：虚拟主机名称。<br>$remote_addr：远程客户端的IP地址。<br>-：空白，用一个“-”占位符替代，历史原因导致还存在。<br>$remote_user：远程客户端用户名称，用于记录浏览者进行身份验证时提供的名字，如登录百度的用户名scq2099yt，如果没有登录就是空白。<br>[$time_local]：访问的时间与时区，比如18&#x2F;Jul&#x2F;2012:17:00:01 +0800，时间信息最后的”+0800”表示服务器所处时区位于UTC之后的8小时。<br>$request：请求的URI和HTTP协议，这是整个PV日志记录中最有用的信息，记录服务器收到一个什么样的请求<br>$status：记录请求返回的http状态码，比如成功是200。<br>$upstream_status：upstream状态，比如成功是200.<br>$upstream_addr:后端服务器的IP地址<br>在server{}中添加：add_header backendIP $upstream_addr;add_header backendCode $upstream_status;<br>$body_bytes_sent：发送给客户端的文件主体内容的大小，比如899，可以将日志每条记录中的这个值累加起来以粗略估计服务器吞吐量。<br>$http_referer：记录从哪个页面链接访问过来的。<br>$http_user_agent：客户端浏览器信息<br>$http_x_forwarded_for：客户端的真实ip，通常web服务器放在反向代理的后面，这样就不能获取到客户的IP地址了，通过$remote_add拿到的IP地址是反向代理服务器的iP地址。反向代理服务器在转发请求的http头信息中，可以增加x_forwarded_for信息，用以记录原有客户端的IP地址和原来客户端的请求的服务器地址。<br>$ssl_protocol：SSL协议版本，比如TLSv1。<br>$ssl_cipher：交换数据中的算法，比如RC4-SHA。<br>$upstream_addr：upstream的地址，即真正提供服务的主机地址。<br>$request_time：整个请求的总时间。<br>$upstream_response_time：请求过程中，upstream的响应时间。</p>
</blockquote>
<br>
# 四、拉取镜像
**注意filebeat和elk的版本需要一致**
docker pull sebp/elk:7.6.1
docker pull elastic/filebeat:7.6.1

<h1 id="五、配置文件"><a href="#五、配置文件" class="headerlink" title="五、配置文件"></a>五、配置文件</h1><p><strong>1)宿主机上创建文件夹</strong><br>mkdir -p &#x2F;root&#x2F;elk4log&#x2F;conf.d<br>mkdir -p &#x2F;root&#x2F;filebeat&#x2F;conf.d</p>
<p><strong>2)在文件夹下编写配置文件</strong><br>vim &#x2F;root&#x2F;elk4log&#x2F;conf.d&#x2F;02-beats-input.conf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">input &#123;    </span><br><span class="line">    tcp &#123;         </span><br><span class="line">        mode =&gt; &quot;server&quot;</span><br><span class="line">        port =&gt; 5044</span><br><span class="line">        codec =&gt; json_lines</span><br><span class="line">        type =&gt; &quot;microserver&quot;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line">input &#123;</span><br><span class="line">    beats &#123;</span><br><span class="line">        port =&gt; 5045</span><br><span class="line">        codec =&gt; json</span><br><span class="line">        type =&gt; &quot;nginx&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">filter &#123;</span><br><span class="line">    date &#123;</span><br><span class="line">        match =&gt; [&quot;time_local&quot;,&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;]  # 解析&quot;14/Mar/2017:00:00:02 +0800&quot;</span><br><span class="line">        target =&gt; &quot;time_local&quot;	# 指定覆盖到的字段，缺省为@timestamp</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">output&#123;</span><br><span class="line">    if [type] == &quot;microserver&quot; &#123;</span><br><span class="line">        elasticsearch &#123;</span><br><span class="line">            hosts =&gt; [&quot;192.168.32.128:9200&quot;]  # 127.0.0.7:9200</span><br><span class="line">            index =&gt; &quot;smartcook-log-%&#123;+YYYY.MM.dd&#125;&quot;</span><br><span class="line">            #manage_template =&gt; true</span><br><span class="line">            #template =&gt; &quot;&quot;</span><br><span class="line">            #template_name =&gt; &quot;apache_elastic_example&quot;</span><br><span class="line">            #template_overwrite =&gt; true</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if [type] == &quot;nginx&quot; &#123;</span><br><span class="line">        elasticsearch &#123;</span><br><span class="line">            hosts =&gt; [&quot;192.168.32.128:9200&quot;]  # 127.0.0.7:9200</span><br><span class="line">            index =&gt; &quot;nginx-zuul-log-%&#123;+YYYY.MM.dd&#125;&quot;</span><br><span class="line">            manage_template =&gt; true</span><br><span class="line">            #文件中的template的名字需要与index对应，用*匹配日期</span><br><span class="line">            template =&gt; &quot;/etc/logstash/conf.d/gateway_zuul_template.json&quot; </span><br><span class="line">            template_name =&gt; &quot;nginx-zuul-log&quot;</span><br><span class="line">            template_overwrite =&gt; true</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>vim &#x2F;root&#x2F;elk4log&#x2F;conf.d&#x2F;gateway_zuul_template.json</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;order&quot;: 0,   </span><br><span class="line">  &quot;template&quot;: &quot;nginx-zuul-log*&quot;, </span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;index&quot;: &#123;</span><br><span class="line">      &quot;number_of_shards&quot;: &quot;5&quot;,  </span><br><span class="line">      &quot;number_of_replicas&quot;: &quot;1&quot;,  </span><br><span class="line">      &quot;refresh_interval&quot;: &quot;20s&quot; </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;properties&quot;: &#123;</span><br><span class="line">      &quot;@timestamp&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;date&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;@version&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;server_name&quot;: &#123;</span><br><span class="line">        &quot;type&quot;:&quot;keyword&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;remote_addr&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;remote_user&quot;: &#123;</span><br><span class="line">        &quot;type&quot;:&quot;keyword&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;time_local&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;date&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;request&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;status&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;integer&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;upstream_status&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;integer&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;body_bytes_sent&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;long&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;http_referer&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;http_user_agent&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;http_x_forwarded_for&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;ssl_protocol&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;ssl_cipher&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;upstream_addr&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;request_time&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;date&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;upstream_response_time&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;long&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>vim &#x2F;root&#x2F;filebeat&#x2F;conf.d&#x2F;filebeat.yml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">filebeat.inputs:</span><br><span class="line">- type: log</span><br><span class="line">  enabled: true</span><br><span class="line">  paths:</span><br><span class="line">    - /var/log/nginx/gateway_access.log</span><br><span class="line"></span><br><span class="line">#============================= Filebeat modules ===============================</span><br><span class="line">filebeat.config.modules:</span><br><span class="line">  # Glob pattern for configuration loading</span><br><span class="line">  path: $&#123;path.config&#125;/modules.d/*.yml</span><br><span class="line">  # Set to true to enable config reloading</span><br><span class="line">  reload.enabled: true</span><br><span class="line"></span><br><span class="line">output.logstash:</span><br><span class="line">  # The Logstash hosts</span><br><span class="line">    hosts: [&quot;192.168.32.128:5045&quot;]</span><br></pre></td></tr></table></figure>

<br>
# 六、启动容器
##6.1 启动elk
docker run -d --name elk4log -p 5601:5601 -p 9200:9200 -p 5044:5044 -p 5045:5045 -v /root/elk4log/logstash/conf.d:/etc/logstash/conf.d  -v /root/elk4log/elasticsearch/config:/opt/elasticsearch/config -v /root/elk4log/elasticsearch/data:/var/lib/elasticsearch/nodes sebp/elk

<blockquote>
<p>注：  #5601 - Kibana web 接口  #9200 - Elasticsearch JSON 接口  #5044 - Logstash 微服务日志监听接口  #5045 - Logstash Nginx日志监听接口</p>
</blockquote>
<p>##6.2 启动filebeat<br>docker run -d –name&#x3D;filebeat -v &#x2F;root&#x2F;filebeat&#x2F;conf.d&#x2F;filebeat.yml:&#x2F;usr&#x2F;share&#x2F;filebeat&#x2F;filebeat.yml –volumes-from nginx elastic&#x2F;filebeat:7.6.1</p>
<blockquote>
<p>注 : 如果es启动报错，需要先修改宿主机的配置<br>sudo sh -c “echo ‘vm.max_map_count&#x3D;655360’ &gt;&gt; &#x2F;etc&#x2F;sysctl.conf”<br>sysctl -p 使配置生效</p>
</blockquote>
<p>##6.3 访问UI页面<br>通过<a target="_blank" rel="noopener" href="http://192.168.32.128:5601/">http://192.168.32.128:5601</a>访问Kibana</p>
<p><strong>注：时区问题</strong>  logstash和es使用的都是UTC时间，而kibana默认读取浏览器的时区，所以kibana显示的时间会比logstash和es的多8小时。如果需要调整如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">filter &#123;</span><br><span class="line">  date &#123;</span><br><span class="line">    match =&gt; [&quot;message&quot;,&quot;UNIX_MS&quot;]</span><br><span class="line">    target =&gt; &quot;@timestamp&quot;   </span><br><span class="line">  &#125;</span><br><span class="line">  ruby &#123; </span><br><span class="line">    code =&gt; &quot;event.set(&#x27;timestamp&#x27;, event.get(&#x27;@timestamp&#x27;).time.localtime + 8*60*60)&quot; </span><br><span class="line">  &#125;</span><br><span class="line">  ruby &#123;</span><br><span class="line">    code =&gt; &quot;event.set(&#x27;@timestamp&#x27;,event.get(&#x27;timestamp&#x27;))&quot;</span><br><span class="line">  &#125;</span><br><span class="line">  mutate &#123;</span><br><span class="line">    remove_field =&gt; [&quot;timestamp&quot;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将日志通过logstash导入到redis中的文档参见：<a target="_blank" rel="noopener" href="https://blog.csdn.net/d597180714/article/details/82382703">https://blog.csdn.net/d597180714/article/details/82382703</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">CJ</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/05/06/ELK/ELK%E9%85%8D%E5%90%88Filebeat%E5%AE%8C%E6%88%90%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86/">http://example.com/2023/05/06/ELK/ELK%E9%85%8D%E5%90%88Filebeat%E5%AE%8C%E6%88%90%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Hexo</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/05/06/Docker/Docker%E4%BD%BF%E7%94%A8%E5%9F%BA%E7%A1%80/" title="Docker使用基础"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Docker使用基础</div></div></a></div><div class="next-post pull-right"><a href="/2023/05/06/ELK/Elasticsearch-%E5%9F%BA%E7%A1%80/" title="Elasticsearch-基础"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Elasticsearch-基础</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">CJ</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">419</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">38</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">一、组件介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-Filebeat"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 Filebeat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-Logstash"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 Logstash</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-Elasticsearch"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 Elasticsearch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-Kibana"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 Kibana</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-Nginx%E9%85%8D%E7%BD%AE"><span class="toc-number">1.5.</span> <span class="toc-text">3.2 Nginx配置</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.</span> <span class="toc-text">五、配置文件</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/05/06/MySQL/%E6%B3%A8%E8%A7%A3@Select%E5%92%8C@Insert/" title="注解@Select和@Insert">注解@Select和@Insert</a><time datetime="2023-05-06T05:48:28.906Z" title="发表于 2023-05-06 13:48:28">2023-05-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/05/06/%E5%90%8E%E7%AB%AF%E6%A1%86%E6%9E%B6/%E6%B3%A8%E8%A7%A3@EnableAutoConfiguration/" title="注解@EnableAutoConfiguration">注解@EnableAutoConfiguration</a><time datetime="2023-05-06T05:48:06.027Z" title="发表于 2023-05-06 13:48:06">2023-05-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/05/06/%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%A6%BB%E7%BA%BF/%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%9B%86%E7%BE%A4%E7%9B%91%E6%8E%A7%E6%A1%86%E6%9E%B6/" title="大数据集群监控框架">大数据集群监控框架</a><time datetime="2023-05-06T05:42:56.298Z" title="发表于 2023-05-06 13:42:56">2023-05-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/05/06/%E9%AB%98%E5%B9%B6%E5%8F%91/HashMap%E5%B9%B6%E5%8F%91%E9%97%AE%E9%A2%98%E5%8F%8AConcurrentHashMap%E5%8E%9F%E7%90%86/" title="HashMap并发问题及ConcurrentHashMap原理">HashMap并发问题及ConcurrentHashMap原理</a><time datetime="2023-05-06T05:31:21.103Z" title="发表于 2023-05-06 13:31:21">2023-05-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/05/06/%E9%AB%98%E5%B9%B6%E5%8F%91/Stream%E5%8E%9F%E7%90%86/" title="Stream原理">Stream原理</a><time datetime="2023-05-06T05:31:21.103Z" title="发表于 2023-05-06 13:31:21">2023-05-06</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By CJ</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>