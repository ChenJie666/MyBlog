<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Flink-1-13-åŸºæœ¬æ¦‚å¿µå’Œéƒ¨ç½² | Hexo</title><meta name="author" content="CJ"><meta name="copyright" content="CJ"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="#ä¸€ã€ç®€ä»‹Flinkæ˜¯ä¸€ä¸ªæ¡†æ¶å’Œåˆ†å¸ƒå¼å¤„ç†å¼•æ“ï¼Œç”¨äºå¯¹æ— ç•Œå’Œæœ‰ç•Œæ•°æ®æµè¿›è¡ŒçŠ¶æ€è®¡ç®—ã€‚å®ç°å¤„ç†çš„ä½å»¶è¿Ÿã€é«˜ååã€å‡†ç¡®æ€§å’Œå®¹é”™æ€§ã€‚ éœ€è¦è§£å†³çš„é—®é¢˜ï¼š1.å¦‚ä½•ä¿è¯å¤„ç†ç»“æœå‡†ç¡®æ€§2.å¦‚ä½•ä¿è¯æ•°æ®çš„æ—¶åºæ€§3.å¦‚ä½•ä¿è¯å®¹ç¾ é‚£äº›è¡Œä¸šéœ€è¦å¤„ç†æµæ•°æ®ï¼š1.ç”µå•†å’Œå¸‚åœºè¥é”€ï¼šæ•°æ®æŠ¥è¡¨ã€å¹¿å‘ŠæŠ•æ”¾ã€ä¸šåŠ¡æµç¨‹éœ€è¦2.ç‰©è”ç½‘ï¼šä¼ æ„Ÿå™¨å®æ—¶æ•°æ®é‡‡é›†å’Œæ˜¾ç¤ºã€å®æ—¶æŠ¥è­¦ï¼Œäº¤é€šè¿è¾“ä¸š3.ç”µä¿¡ä¸šï¼šåŸºç«™æµé‡è°ƒé…4.å®æ—¶ç»“ç®—å’Œé€šçŸ¥æ¨é€ï¼Œå®æ—¶æ£€">
<meta property="og:type" content="article">
<meta property="og:title" content="Flink-1-13-åŸºæœ¬æ¦‚å¿µå’Œéƒ¨ç½²">
<meta property="og:url" content="http://example.com/2023/05/06/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%97%B6/Flink-1-13-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E9%83%A8%E7%BD%B2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="#ä¸€ã€ç®€ä»‹Flinkæ˜¯ä¸€ä¸ªæ¡†æ¶å’Œåˆ†å¸ƒå¼å¤„ç†å¼•æ“ï¼Œç”¨äºå¯¹æ— ç•Œå’Œæœ‰ç•Œæ•°æ®æµè¿›è¡ŒçŠ¶æ€è®¡ç®—ã€‚å®ç°å¤„ç†çš„ä½å»¶è¿Ÿã€é«˜ååã€å‡†ç¡®æ€§å’Œå®¹é”™æ€§ã€‚ éœ€è¦è§£å†³çš„é—®é¢˜ï¼š1.å¦‚ä½•ä¿è¯å¤„ç†ç»“æœå‡†ç¡®æ€§2.å¦‚ä½•ä¿è¯æ•°æ®çš„æ—¶åºæ€§3.å¦‚ä½•ä¿è¯å®¹ç¾ é‚£äº›è¡Œä¸šéœ€è¦å¤„ç†æµæ•°æ®ï¼š1.ç”µå•†å’Œå¸‚åœºè¥é”€ï¼šæ•°æ®æŠ¥è¡¨ã€å¹¿å‘ŠæŠ•æ”¾ã€ä¸šåŠ¡æµç¨‹éœ€è¦2.ç‰©è”ç½‘ï¼šä¼ æ„Ÿå™¨å®æ—¶æ•°æ®é‡‡é›†å’Œæ˜¾ç¤ºã€å®æ—¶æŠ¥è­¦ï¼Œäº¤é€šè¿è¾“ä¸š3.ç”µä¿¡ä¸šï¼šåŸºç«™æµé‡è°ƒé…4.å®æ—¶ç»“ç®—å’Œé€šçŸ¥æ¨é€ï¼Œå®æ—¶æ£€">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png">
<meta property="article:published_time" content="2023-05-06T05:31:21.047Z">
<meta property="article:modified_time" content="2023-05-06T05:31:21.047Z">
<meta property="article:author" content="CJ">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2023/05/06/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%97%B6/Flink-1-13-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E9%83%A8%E7%BD%B2/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Flink-1-13-åŸºæœ¬æ¦‚å¿µå’Œéƒ¨ç½²',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-05-06 13:31:21'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">419</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">38</div></a></div><hr/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Hexo"><span class="site-name">Hexo</span></a></span><div id="menus"><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Flink-1-13-åŸºæœ¬æ¦‚å¿µå’Œéƒ¨ç½²</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2023-05-06T05:31:21.047Z" title="å‘è¡¨äº 2023-05-06 13:31:21">2023-05-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2023-05-06T05:31:21.047Z" title="æ›´æ–°äº 2023-05-06 13:31:21">2023-05-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%97%B6/">å¤§æ•°æ®å®æ—¶</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Flink-1-13-åŸºæœ¬æ¦‚å¿µå’Œéƒ¨ç½²"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>#ä¸€ã€ç®€ä»‹<br>Flinkæ˜¯ä¸€ä¸ªæ¡†æ¶å’Œåˆ†å¸ƒå¼å¤„ç†å¼•æ“ï¼Œç”¨äºå¯¹æ— ç•Œå’Œæœ‰ç•Œæ•°æ®æµè¿›è¡ŒçŠ¶æ€è®¡ç®—ã€‚å®ç°å¤„ç†çš„<strong>ä½å»¶è¿Ÿã€é«˜ååã€å‡†ç¡®æ€§å’Œå®¹é”™æ€§</strong>ã€‚</p>
<p><strong>éœ€è¦è§£å†³çš„é—®é¢˜ï¼š</strong><br>1.å¦‚ä½•ä¿è¯å¤„ç†ç»“æœå‡†ç¡®æ€§<br>2.å¦‚ä½•ä¿è¯æ•°æ®çš„æ—¶åºæ€§<br>3.å¦‚ä½•ä¿è¯å®¹ç¾</p>
<p><strong>é‚£äº›è¡Œä¸šéœ€è¦å¤„ç†æµæ•°æ®ï¼š</strong><br>1.ç”µå•†å’Œå¸‚åœºè¥é”€ï¼šæ•°æ®æŠ¥è¡¨ã€å¹¿å‘ŠæŠ•æ”¾ã€ä¸šåŠ¡æµç¨‹éœ€è¦<br>2.ç‰©è”ç½‘ï¼šä¼ æ„Ÿå™¨å®æ—¶æ•°æ®é‡‡é›†å’Œæ˜¾ç¤ºã€å®æ—¶æŠ¥è­¦ï¼Œäº¤é€šè¿è¾“ä¸š<br>3.ç”µä¿¡ä¸šï¼šåŸºç«™æµé‡è°ƒé…<br>4.å®æ—¶ç»“ç®—å’Œé€šçŸ¥æ¨é€ï¼Œå®æ—¶æ£€æµ‹å¼‚å¸¸è¡Œä¸º</p>
<p>#äºŒã€å¤„ç†æ¶æ„å¯¹æ¯”<br>##2.1 ç¦»çº¿å¤„ç†æ¶æ„<br><img src="/Flink-1-13-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E9%83%A8%E7%BD%B2.assets%5Cd9643ec651874886add7700d21e65243.png" alt="image.png"><br>å­˜å‚¨ä¸å¤„ç†æ˜¯åˆ†ç¦»çš„ã€‚</p>
<br>
##2.2 æµå¼å¤„ç†æ¡†æ¶
- ![image.png](Flink-1-13-åŸºæœ¬æ¦‚å¿µå’Œéƒ¨ç½².assets b42a36ffeb14da6a61ff2510926cb68.png)

<p><strong>å‘å±•æ€è·¯ï¼š</strong><br>oltpä¼šå¯¹æ¯ä¸ªäº‹ä»¶è¿›è¡Œå³æ—¶å¤„ç†ï¼Œä¿è¯äº†æ—¶æ•ˆæ€§ï¼Œä½†æ˜¯æ— æ³•å¤„ç†å¤§è§„æ¨¡æ•°æ®ï¼›olapä¼šå°†æ•°æ®è¿›è¡Œç´¯ç§¯ï¼Œåˆ°ä¸€å®šç¨‹åº¦åè¿›è¡Œç»Ÿè®¡åˆ†æï¼Œå¯ä»¥å¤„ç†å¤§è§„æ¨¡æ•°æ®ï¼Œä½†æ˜¯æ— æ³•ä¿è¯æ—¶æ•ˆæ€§ï¼›<br>ç»“åˆoltpå’Œolapçš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯æ—¶æ•ˆæ€§ï¼Œåˆè¦ä¿è¯å¤§æ•°æ®é‡çš„å¤„ç†ï¼Œé‚£ä¹ˆå¯ä»¥å°†æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå¯¹æ¯ä¸ªåˆ°è¾¾çš„æ•°æ®éƒ½è¿›è¡Œè®¡ç®—ï¼Œé€šè¿‡æ‰©å±•é›†ç¾¤ä¿è¯é«˜ååã€‚</p>
<p>###2.2.1 ç¬¬ä¸€ä»£æµå¼å¤„ç†æ¡†æ¶ï¼ˆStormï¼‰</p>
<ul>
<li><img src="/Flink-1-13-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E9%83%A8%E7%BD%B2.assets%5C51f756a75bd74136b11a8bacd048c4b7.png" alt="image.png"></li>
</ul>
<p>ç¬¬ä¸€ä»£æµå¼å¤„ç†æ¡†æ¶ï¼Œå¦‚stormï¼Œä¸ºäº†è§£å†³å†…å­˜ä¸­æ•°æ®çš„å¯é æ€§ï¼Œå¼•å…¥äº†è¿œç¨‹å­˜å‚¨çš„æ¦‚å¿µï¼Œå³æœ‰çŠ¶æ€çš„æµå¼å¤„ç†ã€‚è™½ç„¶ä¿è¯äº†ä½å»¶è¿Ÿï¼Œä½†æ˜¯æ²¡æœ‰ä¿è¯æ•°æ®çš„ååé‡ã€æ—¶åºæ€§å’Œå‡†ç¡®æ€§ã€‚</p>
<p><strong>ä¸ç¬¬ä¸‰ä»£æµå¼å¤„ç†æ¡†æ¶</strong></p>
<table>
<thead>
<tr>
<th>å¯¹æ¯”ç‚¹</th>
<th>Storm</th>
<th>Spark Streaming</th>
</tr>
</thead>
<tbody><tr>
<td>å®æ—¶è®¡ç®—æ¨¡å‹</td>
<td>çº¯å®æ—¶ï¼Œæ¥ä¸€æ¡æ•°æ®ï¼Œå¤„ç†ä¸€æ¡æ•°æ®</td>
<td>å‡†å®æ—¶ï¼Œå¯¹ä¸€ä¸ªæ—¶é—´æ®µå†…çš„æ•°æ®æ”¶é›†èµ·æ¥ï¼Œä½œä¸ºä¸€ä¸ªRDDï¼Œå†å¤„ç†</td>
</tr>
<tr>
<td>å®æ—¶è®¡ç®—å»¶è¿Ÿåº¦</td>
<td>æ¯«ç§’çº§</td>
<td>ç§’çº§</td>
</tr>
<tr>
<td>ååé‡</td>
<td>ä½</td>
<td>é«˜</td>
</tr>
<tr>
<td>äº‹åŠ¡æœºåˆ¶</td>
<td>æ”¯æŒå®Œå–„</td>
<td>æ”¯æŒï¼Œä½†ä¸å¤Ÿå®Œå–„</td>
</tr>
<tr>
<td>å¥å£®æ€§ &#x2F; å®¹é”™æ€§</td>
<td>ZooKeeperï¼ŒAckerï¼Œéå¸¸å¼º</td>
<td>Checkpointï¼ŒWALï¼Œä¸€èˆ¬</td>
</tr>
<tr>
<td>åŠ¨æ€è°ƒæ•´å¹¶è¡Œåº¦</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
</tr>
</tbody></table>
<br>
###2.2.2 ç¬¬äºŒä»£æµå¼å¤„ç†æ¶æ„ï¼ˆlambdaæ¶æ„ï¼‰
- ![image.png](Flink-1-13-åŸºæœ¬æ¦‚å¿µå’Œéƒ¨ç½².assets\174e164d3f05435b9bf24fa4f892a8b9.png)
ä½¿ç”¨ä¸¤å¥—ç³»ç»Ÿï¼Œæµå¤„ç†ç³»ç»Ÿä¿è¯ä½å»¶è¿Ÿï¼Œæ‰¹å¤„ç†ç³»ç»Ÿæ¥æ ¡å‡†ç»“æœå‡†ç¡®æ€§ã€‚

<br>
###2.2.3 ç¬¬ä¸‰ä»£æµå¼å¤„ç†æ¶æ„ ï¼ˆFlink/Spark Streamingï¼‰
**Flinkçš„ä¸»è¦ç‰¹ç‚¹ï¼š**
- äº‹ä»¶é©±åŠ¨ï¼ˆEvent-drivenï¼‰ï¼šä¸€ä¸ªäº‹ä»¶è®°å½•è¿›è¡Œä¸€æ¬¡å¤„ç†ï¼ŒåŒºåˆ«äºé¡ºåºå’Œæµç¨‹é©±åŠ¨ã€‚![image.png](Flink-1-13-åŸºæœ¬æ¦‚å¿µå’Œéƒ¨ç½².assets\6ff925765ea941758c216fc488eb37fa.png)

<ul>
<li><p>åŸºäºæµçš„ä¸–ç•Œè§‚ï¼šç¦»çº¿æ•°æ®æ˜¯æœ‰ç•Œçš„æµï¼›å®æ—¶æ•°æ®æ˜¯ä¸€ä¸ªæ²¡æœ‰ç•Œé™çš„æµï¼Œè¿™å°±æ˜¯æ‰€è°“çš„æœ‰ç•Œæµå’Œæ— ç•Œæµã€‚![image.png](Flink-1-13-åŸºæœ¬æ¦‚å¿µå’Œéƒ¨ç½².assets2cd75cff97f4367a3a7c4fc90f19aea.png)</p>
</li>
<li><p>åˆ†å±‚APIï¼šè¶Šé¡¶å±‚è¶ŠæŠ½è±¡ï¼Œè¡¨è¾¾å«ä¹‰è¶Šç®€æ˜ï¼Œä½¿ç”¨è¶Šæ–¹ä¾¿ï¼›è¶Šåº•å±‚è¶Šå…·ä½“ï¼Œè¡¨è¾¾èƒ½åŠ›è¶Šä¸°å¯Œï¼Œä½¿ç”¨è¶Šçµæ´»ã€‚å¦‚æœé¡¶å±‚APIä¸å¤Ÿç”¨ï¼Œå¯ä»¥é€šè¿‡åº•å±‚APIè¿›è¡Œå®ç°ã€‚![image.png](Flink-1-13-åŸºæœ¬æ¦‚å¿µå’Œéƒ¨ç½².assetse2d83caacf441008edd95e4e964f3c2.png)<br><strong>SQL&#x2F;Table APIï¼š</strong>å¦‚æœä¸šåŠ¡é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œå¯ä»¥ä½¿ç”¨é¡¶å±‚çš„APIè¿›è¡Œå®ç°ï¼›<br><strong>DataStream APIï¼š</strong>å¯ä»¥å¯¹æµè¿›è¡Œè‡ªå®šä¹‰è½¬æ¢å’Œæ“ä½œï¼Œå¦‚å¼€çª—ï¼›ä¹Ÿå¯ä»¥ä½¿ç”¨DataSetè¿›è¡Œæ‰¹å¤„ç†æ“ä½œã€‚æ˜¯æœ€ä¸ºå¸¸ç”¨çš„APIå±‚çº§ã€‚<br><strong>ProcessFunctionï¼ˆeventsï¼Œstateï¼Œtimeï¼‰ï¼š</strong>å¯¹äºéå¸¸å¤æ‚çš„ä¸šåŠ¡åœºæ™¯ï¼ŒDataStream APIéƒ½ä¸èƒ½å®ç°ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨è¿™ä¸ªæœ€åº•å±‚çš„APIï¼Œå¯ä»¥è‡ªå®šä¹‰ä»»ä½•åŠŸèƒ½ã€‚å¯ä»¥è·å–å½“å‰æ‰€æœ‰çš„<code>æ—¶é—´(time)</code>å’Œ<code>çŠ¶æ€(state)</code>ï¼Œå¯ä»¥å®šä¹‰<code>å®šæ—¶å™¨</code>ã€‚<br>Flink æä¾›äº† 8 ä¸ª Process Functionï¼š<br>ï‚· ProcessFunction<br>ï‚· KeyedProcessFunction<br>ï‚· CoProcessFunction<br>ï‚· ProcessJoinFunction<br>ï‚· BroadcastProcessFunction<br>ï‚· KeyedBroadcastProcessFunction<br>ï‚· ProcessWindowFunction<br>ï‚· ProcessAllWindowFunction</p>
</li>
<li><p>å…¶ä»–ç‰¹ç‚¹ï¼šæ”¯æŒäº‹ä»¶æ—¶é—´å’Œå¤„ç†æ—¶é—´ï¼›<code>ç²¾ç¡®ä¸€æ¬¡</code>çš„çŠ¶æ€ä¸€è‡´æ€§ä¿è¯ï¼›ä½å»¶è¿Ÿï¼Œæ¯ç§’å¤„ç†ç™¾ä¸‡ä¸ªäº‹ä»¶ï¼Œ<code>æ¯«ç§’çº§å»¶è¿Ÿ</code>ï¼›ä¸ä¼—å¤šå¸¸ç”¨çš„å­˜å‚¨ç³»ç»Ÿçš„è¿æ¥ï¼›<code>é«˜å¯ç”¨</code>ï¼Œ<code>åŠ¨æ€æ‰©å±•</code>ï¼Œå®ç°7*24å°æ—¶å…¨å¤©å€™è¿è¡Œã€‚</p>
</li>
<li><p><img src="/Flink-1-13-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E9%83%A8%E7%BD%B2.assets%5C93b90f7dc8344c2ba6a50048dddbe61f.png" alt="image.png"></p>
</li>
</ul>
<p><strong>Flink åŒºåˆ«ä¸ä¼ ç»Ÿæ•°æ®å¤„ç†æ¡†æ¶çš„ç‰¹æ€§å¦‚ä¸‹</strong><br>âš« é«˜ååå’Œä½å»¶è¿Ÿã€‚æ¯ç§’å¤„ç†æ•°ç™¾ä¸‡ä¸ªäº‹ä»¶ï¼Œæ¯«ç§’çº§å»¶è¿Ÿã€‚<br>âš« ç»“æœçš„å‡†ç¡®æ€§ã€‚Flink æä¾›äº†äº‹ä»¶æ—¶é—´ï¼ˆevent-timeï¼‰å’Œå¤„ç†æ—¶é—´ï¼ˆprocessing-timeï¼‰<br>è¯­ä¹‰ã€‚å¯¹äºä¹±åºäº‹ä»¶æµï¼Œäº‹ä»¶æ—¶é—´è¯­ä¹‰ä»ç„¶èƒ½æä¾›ä¸€è‡´ä¸”å‡†ç¡®çš„ç»“æœã€‚<br>âš« ç²¾ç¡®ä¸€æ¬¡ï¼ˆexactly-onceï¼‰çš„çŠ¶æ€ä¸€è‡´æ€§ä¿è¯ã€‚<br>âš« å¯ä»¥è¿æ¥åˆ°æœ€å¸¸ç”¨çš„å­˜å‚¨ç³»ç»Ÿï¼Œå¦‚ Apache Kafkaã€Apache Cassandraã€Elasticsearchã€<br>JDBCã€Kinesis å’Œï¼ˆåˆ†å¸ƒå¼ï¼‰æ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚ HDFS å’Œ S3ã€‚<br>âš« é«˜å¯ç”¨ã€‚æœ¬èº«é«˜å¯ç”¨çš„è®¾ç½®ï¼ŒåŠ ä¸Šä¸ K8sï¼ŒYARN å’Œ Mesos çš„ç´§å¯†é›†æˆï¼Œå†åŠ ä¸Šä»æ•…<br>éšœä¸­å¿«é€Ÿæ¢å¤å’ŒåŠ¨æ€æ‰©å±•ä»»åŠ¡çš„èƒ½åŠ›ï¼ŒFlink èƒ½åšåˆ°ä»¥æå°‘çš„åœæœºæ—¶é—´ 7Ã—24 å…¨å¤©å€™<br>è¿è¡Œã€‚<br>âš« èƒ½å¤Ÿæ›´æ–°åº”ç”¨ç¨‹åºä»£ç å¹¶å°†ä½œä¸šï¼ˆjobsï¼‰è¿ç§»åˆ°ä¸åŒçš„ Flink é›†ç¾¤ï¼Œè€Œä¸ä¼šä¸¢å¤±åº”ç”¨<br>ç¨‹åºçš„çŠ¶æ€ã€‚</p>
<br>
**SparkStreamingå’ŒFlinkçš„åŒºåˆ«ï¼š**
SparkStreamingé‡‡ç”¨äº†å¾®æ‰¹å¤„ç†æ¨¡å‹ï¼Œè€ŒFlinké‡‡ç”¨äº†åŸºäºæ“ä½œç¬¦çš„è¿ç»­æµæ¨¡å‹ã€‚å› æ­¤ï¼Œå¯¹Apache Sparkå’ŒApache Flinkçš„é€‰æ‹©å®é™…ä¸Šå˜æˆäº†è®¡ç®—æ¨¡å‹çš„é€‰æ‹©ï¼Œè€Œè¿™ç§é€‰æ‹©éœ€è¦åœ¨å»¶è¿Ÿã€ååé‡å’Œå¯é æ€§ç­‰å¤šä¸ªæ–¹é¢è¿›è¡Œæƒè¡¡ã€‚
- æ•°æ®æ¨¡å‹
   - sparké‡‡ç”¨RDDæ¨¡å‹ï¼Œspark streamingçš„DStreamå®é™…ä¸Šå°±æ˜¯ä¸€ç»„ç»„å°æ‰¹æ•°æ®RDDçš„é›†åˆ
   - flinkåŸºæœ¬æ•°æ®æ¨¡å‹æ˜¯æ•°æ®æµï¼Œä»¥åŠäº‹ä»¶(Event)åºåˆ—
- è¿è¡Œæ—¶æ¶æ„
   - sparkæ˜¯æ‰¹è®¡ç®—ï¼Œå°†DAGåˆ’åˆ†ä¸ºä¸åŒçš„stageï¼Œä¸€ä¸ªå®Œæˆåæ‰å¯ä»¥è®¡ç®—ä¸‹ä¸€ä¸ª
   - flinkæ˜¯æ ‡å‡†çš„æµæ‰§è¡Œæ¨¡å¼ï¼Œä¸€ä¸ªäº‹ä»¶åœ¨ä¸€ä¸ªèŠ‚ç‚¹å¤„ç†å®Œæˆåå¯ä»¥ç›´æ¥å‘å¾€ä¸‹ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œå¤„ç†ã€‚
 

<br>
**Sparkåœ¨2.xç‰ˆæœ¬ä¸­å¼•å…¥äº†StructedStreamingï¼Œæ‰çœŸæ­£å®ç°äº†æµå¼å¤„ç†ï¼ŒSparkStreamingä¸Structed Streamingå¯¹æ¯”å¦‚ä¸‹ï¼š**
|æµå¤„ç†æ¨¡å¼ |	SparkStreaming |	Structed streaming |
| --- | --- | --- |
|æ‰§è¡Œæ¨¡å¼ |	Micro Batch |	Micro batch / Streaming |
|API |	Dstream/streamingContext | Dataset/DataFrame,SparkSession |
|Job ç”Ÿæˆæ–¹å¼ |	Timerå®šæ—¶å™¨å®šæ—¶ç”Ÿæˆjob |	Triggerè§¦å‘ |
|æ”¯æŒæ•°æ®æº |	Socket,filstream,kafka,zeroMq,flume,kinesis	 | Socket,filstream,kafka,ratesource |
executed-based |	Executed based on dstream api |	Executed based on sparksql |
Time based |	Processing Time |	ProcessingTime & eventTIme |
| UI |	Built-in |	No |


<br>
# ä¸‰ã€Flink(Scala)çš„ç®€å•ä½¿ç”¨
**ä¾èµ–**
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">flink.version</span>&gt;</span>1.13.0<span class="tag">&lt;/<span class="name">flink.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scala.binary.version</span>&gt;</span>2.12<span class="tag">&lt;/<span class="name">scala.binary.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slf4j.version</span>&gt;</span>1.7.30<span class="tag">&lt;/<span class="name">slf4j.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-streaming-scala_$&#123;scala.binary.version&#125;<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;flink.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-clients_$&#123;scala.binary.version&#125;<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;flink.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;slf4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;slf4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-to-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.14.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- è¯¥æ’ä»¶ç”¨äºå°†scalaä»£ç ç¼–è¯‘ä¸ºclasså­—èŠ‚ç æ–‡ä»¶ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.alchim31.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>scala-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- å£°æ˜ç¼–è¯‘åˆ°mavençš„compileé˜¶æ®µ --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="tag">&lt;/<span class="name">descriptorRef</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>make-assembly<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>single<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>ç¯å¢ƒåˆå§‹åŒ–</strong></p>
<ul>
<li><p>getExecutionEnvironment<br>åˆ›å»ºä¸€ä¸ªæ‰§è¡Œç¯å¢ƒï¼Œè¡¨ç¤ºå½“å‰æ‰§è¡Œç¨‹åºçš„ä¸Šä¸‹æ–‡ã€‚ å¦‚æœç¨‹åºæ˜¯ç‹¬ç«‹è°ƒç”¨çš„ï¼Œåˆ™æ­¤æ–¹æ³•è¿”å›æœ¬åœ°æ‰§è¡Œç¯å¢ƒï¼›å¦‚æœä»å‘½ä»¤è¡Œå®¢æˆ·ç«¯è°ƒç”¨ç¨‹åºä»¥æäº¤åˆ°é›†ç¾¤ï¼Œåˆ™æ­¤æ–¹æ³•è¿”å›æ­¤é›†ç¾¤çš„æ‰§è¡Œç¯å¢ƒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒgetExecutionEnvironmentä¼šæ ¹æ®æŸ¥è¯¢è¿è¡Œçš„æ–¹å¼å†³å®šè¿”å›ä»€ä¹ˆæ ·çš„è¿è¡Œç¯å¢ƒï¼Œæ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§åˆ›å»ºæ‰§è¡Œç¯å¢ƒçš„æ–¹å¼ã€‚</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// è·å–æ‰¹å¤„ç†çš„ç¯å¢ƒå˜é‡</span><br><span class="line">val env: ExecutionEnvironment = ExecutionEnvironment.getExecutionEnvironment</span><br></pre></td></tr></table></figure></li>
<li><p>setParallelism(8)<br>å¦‚æœæ²¡æœ‰è®¾ç½®å¹¶è¡Œåº¦ï¼Œä¼šä»¥flink-conf.yamlä¸­çš„é…ç½®ä¸ºå‡†ï¼Œé»˜è®¤æ˜¯1ã€‚</p>
 <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">parallelism.default:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>createLocalEnvironment<br>è¿”å›æœ¬åœ°æ‰§è¡Œç¯å¢ƒï¼Œéœ€è¦åœ¨è°ƒç”¨æ—¶æŒ‡å®šé»˜è®¤çš„å¹¶è¡Œåº¦ã€‚</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// è·å–æµå¤„ç†çš„ç¯å¢ƒå˜é‡</span><br><span class="line">val env = StreamExecutionEnvironment.createLocalEnvironment(1)</span><br></pre></td></tr></table></figure>
</li>
<li><p>createRemoteEnvironment<br>è¿”å›é›†ç¾¤æ‰§è¡Œç¯å¢ƒï¼Œå°†Jaræäº¤åˆ°è¿œç¨‹æœåŠ¡å™¨ã€‚éœ€è¦åœ¨è°ƒç”¨æ—¶æŒ‡å®šJobManagerçš„IPå’Œç«¯å£å·ï¼Œå¹¶æŒ‡å®šè¦åœ¨é›†ç¾¤ä¸­è¿è¡Œçš„JaråŒ…ã€‚</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val env = ExecutionEnvironment.createRemoteEnvironment(&quot;jobmanage-hostname&quot;, 6123,&quot;YOURPATH//wordcount.jar&quot;)</span><br></pre></td></tr></table></figure></li>
</ul>
<br>
## 3.1 Sourceè¾“å…¥
word_countåŠŸèƒ½ä»£ç 
**â‘ æ‰¹å¤„ç†**
éœ€è¦å¯¼å…¥éšå¼è½¬æ¢ï¼š`import org.apache.flink.api.scala._`
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.flink.api.scala.<span class="type">DataSet</span></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.scala._</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">WordCount</span> </span>&#123;</span><br><span class="line">  <span class="comment">//  **_  çš„ç”¨æ³•ï¼šâ‘ åŒ…ä¸­æ‰€æœ‰ç±»â‘¡ç³»ç»Ÿé»˜è®¤åˆå§‹åŒ–â‘¢å°†å‡½æ•°ä¸æ‰§è¡Œè¿”å›â‘£å‚æ•°å ä½ç¬¦â‘¤éšè—å¯¼å…¥çš„ç±»â‘¥æ ‡è¯†ç¬¦â‘¦ç»å¯¹è·¯å¾„**â‘§case _ ä¸ç®¡ä»€ä¹ˆå€¼éƒ½åŒ¹é…â‘¨case _:BigInt =&gt;...  å½“åé¢ä¸ç”¨è¯¥å˜é‡ï¼Œä¸å…³å¿ƒå˜é‡æ—¶ï¼Œå¯ä»¥ç”¨ _ ä»£æ›¿ã€‚</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]):<span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªæ‰¹å¤„ç†çš„æ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    <span class="keyword">val</span> env: <span class="type">ExecutionEnvironment</span> = <span class="type">ExecutionEnvironment</span>.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</span></span><br><span class="line">    <span class="keyword">val</span> inputPath: <span class="type">String</span> = <span class="string">&quot;C:\Users\Administrator\Desktop\ä¸å¸¸ç”¨çš„é¡¹ç›®\flink_demo\src\main\resources\test.txt&quot;</span></span><br><span class="line">    <span class="keyword">val</span> inputDataSet: <span class="type">DataSet</span>[<span class="type">String</span>] = env.readTextFile(inputPath)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹æ•°æ®è¿›è¡Œè½¬æ¢å¤„ç†ç»Ÿè®¡ï¼Œå…ˆåˆ†è¯ï¼Œå†æŒ‰ç…§wordè¿›è¡Œåˆ†ç»„ï¼Œæœ€åè¿›è¡Œèšåˆç»Ÿè®¡</span></span><br><span class="line">    <span class="keyword">val</span> resultDataSet: <span class="type">DataSet</span>[(<span class="type">String</span>,<span class="type">Int</span>)] = inputDataSet</span><br><span class="line">      .flatMap(_.split(<span class="string">&quot; &quot;</span>))</span><br><span class="line">      .map((_, <span class="number">1</span>))</span><br><span class="line">      .groupBy(<span class="number">0</span>)  <span class="comment">// ä»¥ç¬¬ä¸€ä¸ªå…ƒç´ ä½œä¸ºkeyè¿›è¡Œåˆ†ç»„</span></span><br><span class="line">      .sum(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    resultDataSet.print()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
**â‘¡æµå¤„ç†**
å¦‚åœ¨192.168.32.242èŠ‚ç‚¹ä¸Šå¯åŠ¨å‘½ä»¤`nc -lk 7777`å‘ç«¯å£7777å‘é€æ•°æ®åŒ…
é…ç½®ç¨‹åºçš„å‚æ•°`--host 192.168.32.242 --port 7777`æ¥ç›‘å¬è¯¥ç«¯å£è·å–æµæ•°æ®ã€‚
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.utils.<span class="type">ParameterTool</span></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.scala.&#123;<span class="type">DataStream</span>, <span class="type">StreamExecutionEnvironment</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.scala._</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">StreamWordCount</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªæµå¤„ç†çš„æ‰§è¡Œç¯å¢ƒ  DataStreamApi</span></span><br><span class="line">    <span class="keyword">val</span> env: <span class="type">StreamExecutionEnvironment</span> = <span class="type">StreamExecutionEnvironment</span>.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    env.setParallelism(<span class="number">8</span>) <span class="comment">// è®¾ç½®æœ€å¤§å¹¶è¡Œåº¦ï¼Œé»˜è®¤æ˜¯æœ¬æœºæ ¸å¿ƒæ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¥æ”¶ä¸€ä¸ªsocketæ–‡æœ¬æµ</span></span><br><span class="line">    <span class="keyword">val</span> paramTool: <span class="type">ParameterTool</span> = <span class="type">ParameterTool</span>.fromArgs(args)</span><br><span class="line">    <span class="keyword">val</span> host: <span class="type">String</span> = paramTool.get(<span class="string">&quot;host&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> port: <span class="type">Int</span> = paramTool.getInt(<span class="string">&quot;port&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> inputDataStream: <span class="type">DataStream</span>[<span class="type">String</span>] = env.socketTextStream(host, port)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿›è¡Œè½¬åŒ–å¤„ç†ç»Ÿè®¡</span></span><br><span class="line">    <span class="keyword">val</span> resultDataStream: <span class="type">DataStream</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = inputDataStream</span><br><span class="line">      .flatMap(_.split(<span class="string">&quot; &quot;</span>))</span><br><span class="line">      .filter(_.nonEmpty)</span><br><span class="line">      .map((_, <span class="number">1</span>))</span><br><span class="line">      .keyBy(<span class="number">0</span>) <span class="comment">// æµå¤„ç†æ²¡æœ‰groupByï¼Œä½¿ç”¨keyByè¿›è¡Œèšåˆ</span></span><br><span class="line">      .sum(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    resultDataStream.print() <span class="comment">//åˆ†å¸ƒå¼å¤„ç†ä¼šå¯¼è‡´è¾“å‡ºæ˜¯ä¹±åºçš„</span></span><br><span class="line">    resultDataStream.print().setParallelism(<span class="number">1</span>) <span class="comment">//æ‰“å°çš„å¹¶è¡Œåº¦æ˜¯1ï¼Œä¸ä¼šè¾“å‡ºè¿›ç¨‹å·ã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ä»»åŠ¡åï¼Œå¼€å§‹æ‰§è¡Œ</span></span><br><span class="line">    env.execute(<span class="string">&quot;stream word count&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
ç»“æœå¦‚ä¸‹ï¼Œæœ€å¼€å§‹çš„æ•°å­—è¡¨ç¤ºè¿è¡Œåœ¨å“ªä¸ªçº¿ç¨‹ä¸‹ï¼Œçº¿ç¨‹å·æ˜¯æ ¹æ®keyçš„hashå€¼æ¥å†³å®šçš„
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">6&gt; (word,1)</span><br><span class="line">3&gt; (hello,1)</span><br><span class="line">3&gt; (hello,2)</span><br><span class="line">5&gt; (world,1)</span><br></pre></td></tr></table></figure>
åŸç†ï¼šä¼šå°†keyè®¡ç®—å¾—åˆ°å“ˆå¸Œåå‘é€åˆ°å¯¹åº”çš„çº¿ç¨‹ä¸­ï¼Œè¿™æ ·ç›¸åŒkeyçš„æ•°æ®å‘é€åˆ°åŒä¸€ä¸ªçº¿ç¨‹ä¸­è¿›è¡Œè®¡ç®—ï¼Œä¿è¯äº†æ•°æ®çš„å‡†ç¡®æ€§å’Œååé‡ã€‚
é—®é¢˜ï¼šåˆ†å¸ƒå¼ä¼šå¯¼è‡´æ—¶åºé”™ä¹±ï¼Œå¦‚print()ç®—å­åœ¨ä¸åŒèŠ‚ç‚¹ä¸Šæ‰§è¡Œå¯¼è‡´è¾“å‡ºç»“æœæ—¶é—´é”™ä¹±ã€‚

<p><strong>â‘¢ä»kafkaä¸­è¯»å–æµæ•°æ®</strong><br>æ·»åŠ kafkaè¿æ¥ä¾èµ–</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.flink&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;flink-connector-kafka_$&#123;scala.binary.version&#125;&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>ä»£ç </p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.<span class="type">Properties</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.serialization.<span class="type">SimpleStringSchema</span></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.scala.&#123;<span class="type">DataStream</span>, <span class="type">StreamExecutionEnvironment</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.connectors.kafka.<span class="type">FlinkKafkaConsumer</span></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.scala._</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">StreamKafka</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> env: <span class="type">StreamExecutionEnvironment</span> = <span class="type">StreamExecutionEnvironment</span>.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.ä»é›†åˆä¸­è¯»å–æ•°æ®</span></span><br><span class="line">    <span class="keyword">val</span> readProperties = <span class="keyword">new</span> <span class="type">Properties</span>()</span><br><span class="line">    readProperties.setProperty(<span class="string">&quot;bootstrap.servers&quot;</span>, <span class="string">&quot;192.168.32.242:9092&quot;</span>)</span><br><span class="line">    readProperties.setProperty(<span class="string">&quot;group.id&quot;</span>, <span class="string">&quot;consumer-group&quot;</span>)</span><br><span class="line">    readProperties.setProperty(<span class="string">&quot;key.deserializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>)</span><br><span class="line">    readProperties.setProperty(<span class="string">&quot;value.deserializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> myConsumer = <span class="keyword">new</span> <span class="type">FlinkKafkaConsumer</span>[<span class="type">String</span>](<span class="string">&quot;kafka_test&quot;</span>, <span class="keyword">new</span> <span class="type">SimpleStringSchema</span>(), readProperties)</span><br><span class="line">    <span class="comment">//    myConsumer.setStartFromEarliest()</span></span><br><span class="line">    myConsumer.setStartFromLatest()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> inputStream = env.addSource(myConsumer)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> resultDataStream: <span class="type">DataStream</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = inputStream</span><br><span class="line">      .flatMap(_.split(<span class="string">&quot; &quot;</span>))</span><br><span class="line">      .filter(_.nonEmpty)</span><br><span class="line">      .map((_, <span class="number">1</span>))</span><br><span class="line">      .keyBy(<span class="number">0</span>) <span class="comment">// æµå¤„ç†æ²¡æœ‰groupByï¼Œä½¿ç”¨keyByè¿›è¡Œèšåˆ</span></span><br><span class="line">      .sum(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    resultDataStream.print() <span class="comment">//åˆ†å¸ƒå¼å¤„ç†ä¼šå¯¼è‡´è¾“å‡ºæ˜¯ä¹±åºçš„</span></span><br><span class="line">    resultDataStream.print().setParallelism(<span class="number">1</span>) <span class="comment">//æ‰“å°çš„å¹¶è¡Œåº¦æ˜¯1ï¼Œä¸ä¼šè¾“å‡ºè¿›ç¨‹å·ã€‚</span></span><br><span class="line"></span><br><span class="line">    env.execute(<span class="string">&quot;kafka_source_test&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨kafkaä¸­åˆ›å»ºtopicï¼š<code>bin/kafka-topics.sh --zookeeper bigdata1:2181 --create --topic kafka_test --partitions 3 --replication-factor 1</code><br>å¯åŠ¨ç¨‹åºï¼Œç„¶åå‘åˆ›å»ºçš„topicä¸­æ·»åŠ æ•°æ®<code>bin/kafka-console-producer.sh --broker-list bigdata1:9092 --topic kafka_test</code>è¿›è¡Œæµ‹è¯•ã€‚</p>
<p><strong>â‘£è¯»å–è‡ªå®šä¹‰æ•°æ®æºçš„æµå¼æ•°æ®</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.<span class="type">StreamExecutionEnvironment</span></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.source.<span class="type">SourceFunction</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.util.<span class="type">Random</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">SourceTest</span> </span>&#123;</span><br><span class="line">  <span class="comment">// è‡ªå®šä¹‰æ•°æ®æºè¯»å–æµæ•°æ®</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> env: <span class="type">StreamExecutionEnvironment</span> = <span class="type">StreamExecutionEnvironment</span>.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> stream2 = env.addSource(<span class="keyword">new</span> <span class="type">MySensorSource</span>())</span><br><span class="line"></span><br><span class="line">    stream2.print()</span><br><span class="line"></span><br><span class="line">    env.execute(<span class="string">&quot;diy_source_test&quot;</span>)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰å‡½æ•°å®ç°runå’Œcancelæ–¹æ³•</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySensorSource</span>(<span class="params"></span>) <span class="keyword">extends</span> <span class="title">SourceFunction</span>[<span class="type">SensorReading</span>] </span>&#123;</span><br><span class="line">  <span class="comment">// å®šä¹‰ä¸€ä¸ªæ ‡å¿—ä½è¡¨ç¤ºæ•°æ®æºæ˜¯å¦æ­£å¸¸å‘å‡ºæ•°æ®</span></span><br><span class="line">  <span class="keyword">var</span> running: <span class="type">Boolean</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">cancel</span></span>(): <span class="type">Unit</span> = running = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">run</span></span>(sourceContext: <span class="type">SourceFunction</span>.<span class="type">SourceContext</span>[<span class="type">SensorReading</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªå¾ªç¯ï¼Œä¸åœç”Ÿäº§æ•°æ®ï¼Œé™¤éè¢«cancel</span></span><br><span class="line">    <span class="keyword">val</span> curTemp = <span class="number">1.</span>to(<span class="number">10</span>).map(i =&gt; (<span class="string">&quot;sensor_&quot;</span> + i, <span class="type">Random</span>.nextDouble() * <span class="number">100</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (running) &#123;</span><br><span class="line"></span><br><span class="line">      curTemp.map(</span><br><span class="line">        data =&gt; (data._1, data._2 + <span class="type">Random</span>.nextGaussian())</span><br><span class="line">      )</span><br><span class="line">      <span class="keyword">val</span> curTime = <span class="type">System</span>.currentTimeMillis()</span><br><span class="line">      curTemp.foreach(</span><br><span class="line">        data =&gt; sourceContext.collect(<span class="type">SensorReading</span>(data._1, data._2, curTime))</span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">      <span class="type">Thread</span>.sleep(<span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">SensorReading</span>(<span class="params">name: <span class="type">String</span>, temp: <span class="type">Double</span>, timestamp: <span class="type">Long</span></span>)</span></span><br></pre></td></tr></table></figure>

<br>
## 3.2  Transformè½¬æ¢ç®—å­
### map
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val streamMap = stream.map &#123; x =&gt; x * 2 &#125;</span><br></pre></td></tr></table></figure>

<h3 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap"></a>flatMap</h3><p>flatMap(List(1,2,3))(i â‡’ List(i,i))<br>ç»“æœæ˜¯List(1,1,2,2,3,3),Â <br>List(â€œa bâ€, â€œc dâ€).flatMap(line â‡’ line.split(â€œ â€œ))<br>ç»“æœæ˜¯List(a, b, c, d)ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">val streamFlatMap = stream.flatMap&#123;</span><br><span class="line">    x =&gt; x.split(&quot; &quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h3><p>è¿‡æ»¤ä¸ç¬¦åˆæ¡ä»¶çš„å…ƒç´ </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">val streamFilter = stream.filter&#123;</span><br><span class="line">    x =&gt; x == 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="KeyBy"><a href="#KeyBy" class="headerlink" title="KeyBy"></a>KeyBy</h3><p>DataStream â†’ KeyedStreamï¼šé€»è¾‘åœ°å°†ä¸€ä¸ªæµæ‹†åˆ†æˆä¸ç›¸äº¤çš„åˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºåŒ…å«å…·æœ‰ç›¸åŒkeyçš„å…ƒç´ ï¼Œåœ¨å†…éƒ¨ä»¥hashçš„å½¢å¼å®ç°çš„ã€‚</p>
<h3 id="æ»šåŠ¨èšåˆç®—å­-Rolling-Aggregation"><a href="#æ»šåŠ¨èšåˆç®—å­-Rolling-Aggregation" class="headerlink" title="æ»šåŠ¨èšåˆç®—å­(Rolling Aggregation)"></a>æ»šåŠ¨èšåˆç®—å­(Rolling Aggregation)</h3><p>è¿™äº›ç®—å­å¯ä»¥é’ˆå¯¹KeyedStreamçš„æ¯ä¸€ä¸ªæ”¯æµåšèšåˆã€‚</p>
<ul>
<li>sum()</li>
<li>min()</li>
<li>max()</li>
<li>minBy()</li>
<li>maxBy()</li>
</ul>
<h3 id="Reduce"><a href="#Reduce" class="headerlink" title="Reduce"></a>Reduce</h3><p>KeyedStream â†’ DataStreamï¼šä¸€ä¸ªåˆ†ç»„æ•°æ®æµçš„èšåˆæ“ä½œï¼Œåˆå¹¶å½“å‰çš„å…ƒç´ å’Œä¸Šæ¬¡èšåˆçš„ç»“æœï¼Œäº§ç”Ÿä¸€ä¸ªæ–°çš„å€¼ï¼Œè¿”å›çš„æµä¸­åŒ…å«æ¯ä¸€æ¬¡èšåˆçš„ç»“æœï¼Œè€Œä¸æ˜¯åªè¿”å›æœ€åä¸€æ¬¡èšåˆçš„æœ€ç»ˆç»“æœã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">val stream2 = env.readTextFile(&quot;input/sensor.txt&quot;)</span><br><span class="line">  .map( data =&gt; &#123;</span><br><span class="line">    val dataArray = data.split(&quot;,&quot;)</span><br><span class="line">    SensorReading1(dataArray(0).trim, dataArray(1).trim.toLong, dataArray(2).trim.toDouble)</span><br><span class="line">  &#125;)</span><br><span class="line">  .keyBy(&quot;id&quot;)</span><br><span class="line">  .reduce( (x, y) =&gt; SensorReading1(x.id, y.timestamp, y.temperature.min(x.temperature)) )</span><br></pre></td></tr></table></figure>

<h3 id="Split-å’Œ-Select"><a href="#Split-å’Œ-Select" class="headerlink" title="Split å’Œ Select"></a>Split å’Œ Select</h3><h3 id="Connect-å’Œ-CoMap"><a href="#Connect-å’Œ-CoMap" class="headerlink" title="Connect å’Œ CoMap"></a>Connect å’Œ CoMap</h3><h3 id="Union"><a href="#Union" class="headerlink" title="Union"></a>Union</h3><br>
## 3.3 æ”¯æŒçš„æ•°æ®ç±»å‹

<br>
## 3.4 å®ç°UDFå‡½æ•°

<br>
## 3.5 Sinkè¾“å‡º
è¾“å‡ºåŒ…æ‹¬æ–‡ä»¶ã€Kafkaã€ESã€MySQLç­‰

<br>
###3.4 çª—å£API
çª—å£åˆ†é…å™¨åŒ…æ‹¬æ»šåŠ¨çª—å£ï¼ˆTumblingWindowï¼‰ã€æ»‘åŠ¨çª—å£ï¼ˆSlidingWindowï¼‰ã€ä¼šè¯çª—å£ï¼ˆSessionWindowï¼‰å’Œå…¨å±€çª—å£ï¼ˆGlobalWindowï¼‰ã€‚
- æ»šåŠ¨æ—¶é—´çª—å£(tumbling time window): .timeWindow(Time.seconds(15))
- æ»‘åŠ¨æ—¶é—´çª—å£(sliding time window): .timeWindow(Time.seconds(15), Time.seconds(5))
- ä¼šè¯çª—å£(session window): .window(EventTimeSessionWindows.withGap(Time.minutes(10))
- æ»šåŠ¨è®¡æ•°çª—å£(tumbling count window): .countWindow(5)
- æ»‘åŠ¨æŠ€æœ¯çª—å£(sliding count window): .countWindow(10, 2)

<blockquote>
<p>ç¬¬ä¸€ä¸ªçª—å£çš„èµ·å§‹å’Œç»“æŸæ—¶é—´æ˜¯çª—å£å¤§å°çš„æ•´æ•°å€ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®çª—å£çš„offsetå€¼ä½¿çª—å£è¿›è¡Œåç§»(ä¸»è¦ç”¨æ¥å¤„ç†æŒ‰å¤©å¼€çª—å¯¼è‡´çš„æ—¶åŒºé—®é¢˜ï¼šæ—¶é—´æˆ³æ˜¯æ²¡æœ‰æ—¶åŒºæ¦‚å¿µçš„ï¼ŒåŒ—äº¬æ—¶é—´0ç‚¹-24ç‚¹å¯¹åº”çš„æ ¼æ—å°¼æ²»æ—¶é—´æ˜¯16ç‚¹-16ç‚¹ï¼Œæ‰€ä»¥å¼€çª—ä¹Ÿè¦ -8 ä¸ªå°æ—¶)ã€‚</p>
</blockquote>
<p>KeyedStreamæœ‰windowæ–¹æ³•è°ƒç”¨çª—å£å‡½æ•°ï¼Œ<br>DataStreamæœ‰windowAllæ–¹æ³•è°ƒç”¨çª—å£å‡½æ•°ï¼ˆå› ä¸ºå¹¶è¡Œåº¦æ˜¯1ï¼Œæ€§èƒ½ä¸é«˜ï¼Œæ‰€ä»¥å…ˆè¿›è¡Œèšåˆï¼‰;<br>è°ƒç”¨çª—å£å‡½æ•°ä¹‹åï¼Œå¾—åˆ°çš„æ˜¯WindowedStreamï¼Œæ— ç•Œæµå˜æˆäº†æœ‰ç•Œæµ ï¼Œè°ƒç”¨èšåˆå‡½æ•°åå¾—åˆ°çš„è¿˜æ˜¯DataStreamã€‚</p>
<p>çª—å£å‡½æ•°å¯ä»¥åˆ†ä¸ºå¢é‡èšåˆå‡½æ•°ï¼ˆæ•°æ®æ¥ä¸€æ¡è®¡ç®—ä¸€æ¬¡ï¼‰å’Œå…¨çª—å£å‡½æ•°ï¼ˆæ”¶é›†åç»Ÿä¸€è®¡ç®—ï¼‰ã€‚ReduceFunctionã€AggregateFunctionç­‰å°±æ˜¯å¢é‡èšåˆå‡½æ•°ï¼ŒProcessWindowFunctionã€WindowFunctionå°±æ˜¯å…¨çª—å£å‡½æ•°ã€‚<br>â‘ å¢é‡èšåˆå‡½æ•°AggregateFunction</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">DataStream&lt;Integer&gt; resultDataStream = keyedDataStream</span><br><span class="line">        .timeWindow(Time.seconds(15))</span><br><span class="line">        .aggregate(new AggregateFunction&lt;String, Integer, Integer&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public Integer createAccumulator() &#123;</span><br><span class="line">                return 0;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public Integer add(String s, Integer integer) &#123;</span><br><span class="line">                return integer + 1;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public Integer getResult(Integer integer) &#123;</span><br><span class="line">                return integer;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public Integer merge(Integer integer, Integer acc1) &#123;</span><br><span class="line">                return integer + acc1;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<p>â‘¡å…¨çª—å£å‡½æ•°WindowFunction</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DataStream&lt;Tuple3&lt;String, Long, Integer&gt;&gt; resultDataStream = keyedDataStream.timeWindow(Time.seconds(20)).apply(new WindowFunction&lt;String, Tuple3&lt;String, Long, Integer&gt;, String, TimeWindow&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void apply(String key, TimeWindow window, Iterable&lt;String&gt; input, Collector&lt;Tuple3&lt;String, Long, Integer&gt;&gt; out) throws Exception &#123;</span><br><span class="line">        Integer size = IteratorUtils.toList(input.iterator()).size();</span><br><span class="line">        out.collect(new Tuple3(key, window.getEnd(), size));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<br>
###3.5 å…¶ä»–API
**Keyed Windows:** stream.keyBy().window().trigger().evictor().allowedLateness().sideOutputLateData().reduce/aggregate/fold/apply().getSideOutput();
**Non-Keyed Windows:** stream.windowAll().trigger().evictor().allowedLateness().sideOutputLateData().reduce/aggregate/fold/apply().getSideOutput();

<p>trigger() è§¦å‘å™¨ï¼šå®šä¹‰windowä»€ä¹ˆæ—¶å€™å…³é—­ï¼Œè§¦å‘è®¡ç®—å¹¶è¾“å‡ºç»“æœ<br>evictor() ç§»é™¤å™¨ï¼šå®šä¹‰åˆ é™¤æŸäº›æ•°æ®é€»è¾‘<br>allowedLateness()ï¼šå…è®¸å¤„ç†è¿Ÿåˆ°çš„æ•°æ®<br>sideOutputLateData()ï¼šå°†è¿Ÿåˆ°çš„æ•°æ®æ”¾å…¥åˆ°ä¾§è¾“å‡ºæµ<br>getSideOuntput()ï¼šè·å–ä¾§è¾“å‡ºæµ</p>
<p>![image.png](Flink-1-13-åŸºæœ¬æ¦‚å¿µå’Œéƒ¨ç½².assetsfddb4e16c3f41a4ab06aa2b58fdd948.png)</p>
<br>
#å››ã€æœåŠ¡å™¨ä¸­è¿è¡Œç¨‹åº
## 4.1å•æœºæ¨¡å¼
4.1.1 å¯åŠ¨å•æœºæ¨¡å¼
ä¸‹è½½åœ°å€ï¼š[Apache Download Mirrors](https://www.apache.org/dyn/closer.lua/flink/flink-1.13.0/flink-1.13.0-bin-scala_2.12.tgz)
å¯åŠ¨å‘½ä»¤
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/start-cluster.sh</span><br></pre></td></tr></table></figure>
å¯åŠ¨å•èŠ‚ç‚¹æ¨¡å¼ã€‚
å¯ä»¥è®¿é—®UIç•Œé¢[http://192.168.32.242:8081](http://192.168.32.242:8081/)
![åŸºç¡€é…ç½®](Flink-1-13-åŸºæœ¬æ¦‚å¿µå’Œéƒ¨ç½².assets\252c5e88c05046c2a38b5dbdbf7d815e.png)

<p>##4.1.2 æäº¤ä»»åŠ¡<br><strong>è®¾ç½®å¹¶è¡Œåº¦çš„ä¼˜å…ˆçº§(ç”±é«˜åˆ°ä½)</strong></p>
<ul>
<li>ç®—å­è®¾ç½®</li>
<li>å…¨å±€è®¾ç½®</li>
<li>æäº¤æ—¶UIç•Œé¢è¾“å…¥è®¾ç½®</li>
<li>é…ç½®æ–‡ä»¶è®¾ç½®</li>
</ul>
<p><strong>4.1.3 ä¸Šä¼ æ–‡ä»¶è®¾ç½®å‚æ•°</strong><br><img src="/Flink-1-13-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E9%83%A8%E7%BD%B2.assets%5C13471971112e47f5b6fc8053b14cc0d1.png" alt="é…ç½®å‚æ•°"></p>
<p><strong>4.1.4 æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’</strong><br><img src="/Flink-1-13-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E9%83%A8%E7%BD%B2.assets%5C8b376d6c3fc34f8da318c4e1dc53b855.png" alt="ä»»åŠ¡è®¡åˆ’å›¾JobGraph"></p>
<p><strong>4.1.5 å¯åŠ¨ä»»åŠ¡</strong><br>å¯ä»¥é€šè¿‡UIç•Œé¢æäº¤ä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæäº¤ä»»åŠ¡ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/flink run -c com.iotmars.wecook.StreamWordCount -p 2 /opt/jar/flink-demo-0.0.1-SNAPSHOT-jar-with-dependencies.jar --host localhost --port 6666</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>-c è¡¨ç¤ºç±»è·¯å¾„</li>
<li>-p è¡¨ç¤ºå¹¶è¡Œåº¦</li>
<li>ç„¶ååŠ ä¸Šå¯åŠ¨jarè·¯å¾„</li>
<li>æœ€åæ·»åŠ å‚æ•°<br><code>æ³¨æ„ï¼šå¦‚æœslotä¸å¤Ÿï¼Œä¼šå¯¼è‡´å¡æ­»åœ¨åˆ†é…èµ„æºé˜¶æ®µå¯¼è‡´æœ€åè¶…æ—¶å¤±è´¥ã€‚</code></li>
</ul>
</blockquote>
<p>æŸ¥çœ‹ä»»åŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bin/flink list</span><br><span class="line"># æŸ¥çœ‹å…¨éƒ¨ä»»åŠ¡</span><br><span class="line">bin/flink list -a </span><br></pre></td></tr></table></figure>
<p>å–æ¶ˆä»»åŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/flink cancel [jobId]</span><br></pre></td></tr></table></figure>

<p><strong>4.1.6 æŸ¥çœ‹ä»»åŠ¡</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/flink list [-a]</span><br></pre></td></tr></table></figure>
<p><img src="/Flink-1-13-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E9%83%A8%E7%BD%B2.assets%5Cd8863857b55440e59b6ce241c361ffce.png" alt="image.png"></p>
<p><strong>4.1.7 å–æ¶ˆä»»åŠ¡</strong><br>å¯ä»¥é€šè¿‡UIç•Œé¢å–æ¶ˆä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå–æ¶ˆä»»åŠ¡ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/flink cancel 4198899a1a47f496309fe2da2e31c1f5</span><br></pre></td></tr></table></figure>

<p><strong>4.1.8 åœæ­¢flinké›†ç¾¤</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/stop-cluster.sh</span><br></pre></td></tr></table></figure>

<br>
## 4.2 Yarnæ¨¡å¼
###4.2.1 Session-cluster
**æ¦‚å¿µï¼š**Session-Clusteræ¨¡å¼éœ€è¦å…ˆå¯åŠ¨é›†ç¾¤ï¼Œç„¶åå†æäº¤ä½œä¸šï¼Œæ¥ç€ä¼šå‘yarnç”³è¯·ä¸€å—ç©ºé—´åï¼Œ**èµ„æºæ°¸è¿œä¿æŒä¸å˜**ã€‚å¦‚æœèµ„æºæ»¡äº†ï¼Œä¸‹ä¸€ä¸ªä½œä¸šæ— æ³•æäº¤ï¼Œåªèƒ½ç­‰åˆ°yarnä¸­çš„ä¸€ä¸ªä½œä¸šæ‰§è¡Œå®Œæˆä¹‹åé‡Šæ”¾äº†èµ„æºï¼Œæ‰èƒ½è¿›è¡Œä¸‹ä¸€ä¸ªä½œä¸šä»»åŠ¡ã€‚
æ‰€æœ‰ä½œä¸šå…±äº«Dispatcherå’ŒResourceManagerï¼Œå…±äº«èµ„æºï¼Œé€‚åˆè§„æ¨¡å°æ‰§è¡Œæ—¶é—´çŸ­çš„ä½œä¸šã€‚

<p><code>åœ¨yarnä¸­åˆå§‹åŒ–ä¸€ä¸ªflinké›†ç¾¤ï¼Œå¼€è¾ŸæŒ‡å®šçš„èµ„æºï¼Œä»¥åæäº¤ä»»åŠ¡éƒ½å‘è¿™é‡Œæäº¤ã€‚è¿™ä¸ªflinké›†ç¾¤ä¼šå¸¸é©»åœ¨yarné›†ç¾¤ä¸­ï¼Œé™¤éæ‰‹å·¥åœæ­¢ã€‚</code></p>
<p><strong>å…ˆå¯åŠ¨yarn-sessionï¼š</strong><br>â‘ å¯åŠ¨yarn-sessionï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// æ·»åŠ ç¯å¢ƒå˜é‡</span><br><span class="line">export HADOOP_CLASSPATH=`hadoop classpath`</span><br><span class="line">// å¯åŠ¨yarn-session</span><br><span class="line">yarn-session.sh -n 2 -s 2 -jm 1024 -nm test -d</span><br><span class="line">// æˆ–è°ƒåº¦å™¨ä¸­åˆ›å»ºäº†å¤šä¸ªé˜Ÿåˆ—ï¼Œéœ€è¦æŒ‡å®šé˜Ÿåˆ—</span><br><span class="line">nohup ./yarn-session.sh -s 2 -jm 1024 -tm 2048 -nm flink-on-yarn -qu flink -d 1&gt;/opt/module/flink-1.13.0/log/yarn-session.log 2&gt;/opt/module/flink-1.13.0/log/yarn-session.err &amp;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong><br><strong>-jmï¼š</strong>JobManagerçš„å†…å­˜ï¼ˆMBï¼‰ï¼›<br><strong>-tmï¼š</strong>æ¯ä¸ªtaskmanagerçš„å†…å­˜ï¼ˆMBï¼‰ï¼›<br><strong>-nmï¼š</strong>yarnçš„appNameï¼ˆyarnçš„uiä¸Šçš„åå­—ï¼‰ï¼›<br><strong>-dï¼š</strong>åå°æ‰§è¡Œï¼›<br><strong>-quï¼š</strong>æŒ‡å®šä½¿ç”¨çš„yarné˜Ÿåˆ—<br><strong>-nï¼ˆâ€“containerï¼‰ï¼š</strong>(1.11ç‰ˆæœ¬å¼€å§‹ä¸å†ç”Ÿæ•ˆ)TaskManagerçš„æ•°é‡ï¼›ä¼šæ ¹æ®éœ€æ±‚åŠ¨æ€åˆ†é…ï¼›<br><strong>-sï¼ˆâ€“slotsï¼‰ï¼š</strong>(1.11ç‰ˆæœ¬å¼€å§‹ä¸å†ç”Ÿæ•ˆ)æ¯ä¸ªTaskManagerçš„slotæ•°é‡ï¼Œé»˜è®¤ä¸€ä¸ªslotä¸€ä¸ªsoreï¼Œé»˜è®¤æ¯ä¸ªtaskmanagerçš„slotä¸ªæ•°ä¸º1ï¼Œæœ‰æ—¶å¯ä»¥å¤šä¸€äº›taskmanagerï¼Œåšå†—ä½™ï¼›</p>
</blockquote>
<p>å…³é—­yarn-sessionï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æ‰¾åˆ°flinké›†ç¾¤ä»»åŠ¡çš„idï¼Œç„¶åkill</span><br><span class="line">yarn application -kill application_1616059084025_0002</span><br></pre></td></tr></table></figure>

<p>â‘¡æäº¤ä»»åŠ¡(å’Œstandaloneæ¨¡å¼ä¸€æ ·)ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/flink run -c com.iotmars.wecook.StreamWordCount -p 2 /opt/jar/flink-demo-0.0.1-SNAPSHOT-jar-with-dependencies.jar --host localhost --port 6666</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>-c è¡¨ç¤ºç±»è·¯å¾„</li>
<li>-p è¡¨ç¤ºå¹¶è¡Œåº¦</li>
<li>ç„¶ååŠ ä¸Šå¯åŠ¨jarè·¯å¾„</li>
<li>æœ€åæ·»åŠ å‚æ•°<br><code>æ³¨æ„ï¼šå¦‚æœslotä¸å¤Ÿï¼Œä¼šå¯¼è‡´å¡æ­»åœ¨åˆ†é…èµ„æºé˜¶æ®µå¯¼è‡´æœ€åè¶…æ—¶å¤±è´¥ã€‚</code></li>
</ul>
</blockquote>
<p>â‘¢æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€ï¼šå»yarnæ§åˆ¶å°æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€<br>â‘£å–æ¶ˆyarn-sessionï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn application --kill job_id</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥é€šè¿‡<a target="_blank" rel="noopener" href="http://192.168.32.243:37807/">http://192.168.32.243:37807</a>è®¿é—®Webé¡µé¢ï¼ˆä¼šåœ¨æŸå°æœåŠ¡å™¨ä¸Šéƒ¨ç½²ä¸€ä¸ªWebé¡µé¢ï¼‰</p>
<p>###4.2.2 Per-Job-Cluster<br><strong>æ¦‚å¿µï¼š</strong>ä¸€ä¸ªJobä¼šå¯¹åº”ä¸€ä¸ªé›†ç¾¤ï¼Œæ¯æäº¤ä¸€ä¸ªä½œä¸šä¼šæ ¹æ®è‡ªèº«çš„æƒ…å†µï¼Œéƒ½ä¼šå•ç‹¬å‘yarnç”³è¯·èµ„æºï¼Œç›´åˆ°ä½œä¸šæ‰§è¡Œå®Œæˆï¼Œä¸€ä¸ªä½œä¸šå¤±è´¥ä¸å¦ä¸ä¼šå½±å“ä¸‹ä¸€ä¸ªä½œä¸šçš„æ­£å¸¸æäº¤å’Œè¿è¡Œã€‚ç‹¬äº«Dispatcherå’ŒResourceManagerï¼ŒæŒ‰éœ€æ¥å—èµ„æºç”³è¯·ï¼Œé€‚åˆå¤§è§„æ¨¡é•¿æ—¶é—´è¿è¡Œçš„ä½œä¸šã€‚<br><code>æ¯æ¬¡æäº¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„flinké›†ç¾¤ï¼Œä»»åŠ¡ä¹‹é—´äº’ç›¸ç‹¬ç«‹ï¼Œäº’ä¸å½±å“ï¼Œæ–¹ä¾¿ç®¡ç†ã€‚ä»»åŠ¡æ‰§è¡Œå®Œæˆååˆ›å»ºçš„é›†ç¾¤ä¹Ÿä¼šæ¶ˆå¤±ã€‚</code><br><strong>æ“ä½œï¼š</strong><br>â‘ ä¸å¯åŠ¨yarn-sessionï¼Œç›´æ¥æ‰§è¡Œjob</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flink run -m yarn-cluster -ynm dimetl -p1 -ys 1 -yjm 1024 -ytm 1024m -d -c com.iotmars.wecook.StreamWordCount -yqu flinkqueue /opt/jar/flink-demo-0.0.1-SNAPSHOT-jar-with-dependencies.jar --hostname bigdata3 --port 7777</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>-m yarn-clusterï¼šå¯åŠ¨æ¨¡å¼ä¸ºPer-Job-Cluster</li>
<li>-ynm&#x2F;-yarnname : å¯åŠ¨çš„applicationä»»åŠ¡çš„Name</li>
<li>-p&#x2F;-parallelism 1ï¼šå¹¶è¡Œåº¦è®¾ç½®ä¸º1</li>
<li>-d&#x2F;-detachedï¼šåå°æ‰§è¡Œ</li>
<li>-c&#x2F;-class com.iotmars.wecook.StreamWordCountï¼šæŒ‡å®šè¿è¡Œçš„ä»»åŠ¡åŒ…</li>
<li>-C&#x2F;-classpath : å‘æ¯ä¸ªç”¨æˆ·ä»£ç æ·»åŠ urlï¼Œä»–æ˜¯é€šè¿‡UrlClassLoaderåŠ è½½ã€‚urléœ€è¦æŒ‡å®šæ–‡ä»¶çš„schemaã€‚</li>
<li>-q&#x2F;-sysoutLogging : ç¦æ­¢loggingè¾“å‡ºä½œä¸ºæ ‡å‡†è¾“å‡ºã€‚</li>
<li>-ys 1ï¼šæ¯ä¸ªTaskManagerçš„slotæ•°é‡ï¼Œé»˜è®¤ä¸€ä¸ªslotä¸€ä¸ªcoreï¼Œé»˜è®¤æ¯ä¸ªtaskmanagerçš„slotä¸ªæ•°ä¸º1ï¼Œæœ‰æ—¶å¯ä»¥å¤šä¸€äº›taskmanagerï¼Œåšå†—ä½™ï¼›</li>
<li>-yjm 1024ï¼šJobManagerçš„å†…å­˜ï¼ˆMBï¼‰</li>
<li>-ytm 1024mï¼šæ¯ä¸ªtaskmanagerçš„å†…å­˜ï¼ˆMBï¼‰</li>
<li>-yqu flinkï¼šæŒ‡å®šæäº¤åˆ°åä¸ºflinkçš„yarné˜Ÿåˆ—</li>
<li>â€“parametersï¼šå¯ä»¥è·Ÿè‡ªå®šä¹‰å‚æ•°ï¼Œåœ¨ç¨‹åºä¸­è¿›è¡Œè¯»å–</li>
</ul>
</blockquote>
<p><code>taskmanagerå¯åŠ¨æ•°é‡è®¡ç®—ï¼šæ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„taskmanager.numberOfTaskSlots: 1é…ç½®æ¥ç¡®å®šæ¯ä¸ªtaskmanagerä¸Šå¯åŠ¨çš„slotä¸ªæ•°ï¼Œç„¶åæ ¹æ®ç¨‹åºéœ€è¦çš„slotæ•°é‡æ¥åŠ¨æ€è°ƒæ•´taskmanagerä¸ªæ•°</code></p>
<blockquote>
<p>Yarnæ¨¡å¼æŸ¥çœ‹æ—¥å¿—ï¼šé€šè¿‡Yarnç®¡ç†é¡µé¢æŸ¥çœ‹æ—¥å¿—æœåŠ¡å™¨ä¸Šçš„ä»»åŠ¡æ—¥å¿—ï¼Œå¯ä»¥æŸ¥è¯¢åˆ°jobmanagerçš„æ—¥å¿—ã€‚éœ€è¦æŸ¥çœ‹taskmanagerçš„æ—¥å¿—ï¼Œå°±éœ€è¦åœ¨jobmanagerä¸­æŸ¥è¯¢å¯åŠ¨çš„taskmanagerçš„å®¹å™¨IDå’Œå¯åŠ¨çš„èŠ‚ç‚¹å’Œç«¯å£ã€‚æ‹¼æ¥æ ¼å¼ä¸º<code>http://192.168.101.193:19888/jobhistory/logs/[taskmanaeger_ip]:[taskmanaeger_port]/[taskmanaeger_containerID]/[taskmanaeger_containerID]/[user_name]</code>;<br>å¦‚æœæ˜¯æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼Œurlä¸º <code>http://[taskmanager_ip]:8042/node/containerlogs/[taskmanaeger_containerID]/[user_name]</code>;</p>
</blockquote>
<br>
## 4.3 Kuberneteséƒ¨ç½²
Flinkåœ¨æœ€è¿‘çš„ç‰ˆæœ¬ä¸­ä¹Ÿæ”¯æŒäº†k8séƒ¨ç½²æ¨¡å¼ï¼Œéƒ¨ç½²å¦‚ä¸‹
- â‘ æ­å»ºk8sé›†ç¾¤
- â‘¡é…ç½®å„ç»„ä»¶çš„yamlæ–‡ä»¶
åœ¨k8sä¸Šæ„å»ºFlink Session Clusterï¼Œéœ€è¦å°†Flinké›†ç¾¤çš„ç»„ä»¶å¯¹åº”çš„dockeré•œåƒåˆ†åˆ«åœ¨k8sä¸Šå¯åŠ¨ï¼ŒåŒ…æ‹¬JobManagerã€JobManagerã€JobManagerServiceä¸‰ä¸ªé•œåƒæœåŠ¡ã€‚æ¯ä¸ªé•œåƒæœåŠ¡éƒ½å¯ä»¥ä»ä¸­å¤®é•œåƒä»“åº“ä¸­è·å–ã€‚
- â‘¢å¯åŠ¨Flink Session Cluster
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// å¯åŠ¨jobmanager-serviceæœåŠ¡</span><br><span class="line">kubectl create -f jobmanager-service.yaml</span><br><span class="line">// å¯åŠ¨jobmanager-deploymentæœåŠ¡</span><br><span class="line">kubectl create -f jobmanager-deployment.yaml</span><br><span class="line">// å¯åŠ¨taskmanager-deploymentæœåŠ¡</span><br><span class="line">kubectl create -f taskmanager-deployment.yaml</span><br></pre></td></tr></table></figure>
- â‘£è®¿é—®Flink UIé¡µé¢
é›†ç¾¤å¯åŠ¨åï¼Œå°±å¯ä»¥é€šè¿‡JobManagerServicesä¸­é…ç½®çš„WebUIç«¯å£è¿›è¡Œè®¿é—®
http://{JobManagerHost:Port}/api/v1/namespaces/default/services/flink-jobmanager:ui/proxy

<br>
#äº”ã€ Flinkè¿è¡Œæ¶æ„
linkè¿è¡Œæ—¶æ¶æ„ä¸»è¦åŒ…æ‹¬å››ä¸ªä¸åŒçš„ç»„ä»¶ï¼Œå®ƒä»¬ä¼šåœ¨è¿è¡Œæµå¤„ç†åº”ç”¨ç¨‹åºæ—¶ååŒå·¥ä½œï¼š**ä½œä¸šç®¡ç†å™¨ï¼ˆJobManagerï¼‰**ã€**èµ„æºç®¡ç†å™¨ï¼ˆResourceManagerï¼‰**ã€**ä»»åŠ¡ç®¡ç†å™¨ï¼ˆTaskManagerï¼‰**ï¼Œä»¥åŠ**åˆ†å‘å™¨ï¼ˆDispatcherï¼‰**ã€‚å› ä¸ºFlinkæ˜¯ç”¨Javaå’ŒScalaå®ç°çš„ï¼Œæ‰€ä»¥æ‰€æœ‰ç»„ä»¶éƒ½ä¼šè¿è¡Œåœ¨Javaè™šæ‹Ÿæœºä¸Šã€‚æ¯ä¸ªç»„ä»¶çš„èŒè´£å¦‚ä¸‹ï¼š
- ä½œä¸šç®¡ç†å™¨ï¼ˆJobManagerï¼‰ï¼šæ§åˆ¶ä¸€ä¸ªåº”ç”¨ç¨‹åºæ‰§è¡Œçš„ä¸»è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½ä¼šè¢«ä¸€ä¸ªä¸åŒçš„JobManageræ‰€æ§åˆ¶æ‰§è¡Œã€‚**â‘ **JobManagerä¼šå…ˆæ¥æ”¶åˆ°è¦æ‰§è¡Œçš„åº”ç”¨ç¨‹åºï¼Œè¿™ä¸ªåº”ç”¨ç¨‹åºä¼šåŒ…æ‹¬ï¼šä½œä¸šå›¾ï¼ˆJobGraphï¼‰ã€é€»è¾‘æ•°æ®æµå›¾ï¼ˆlogical dataflow graphï¼‰å’Œæ‰“åŒ…äº†æ‰€æœ‰çš„ç±»ã€åº“å’Œå…¶å®ƒèµ„æºçš„JARåŒ…ã€‚JobManagerä¼šæŠŠJobGraphè½¬æ¢æˆä¸€ä¸ªç‰©ç†å±‚é¢çš„æ•°æ®æµå›¾ï¼Œè¿™ä¸ªå›¾è¢«å«åšâ€œæ‰§è¡Œå›¾â€ï¼ˆExecutionGraphï¼‰ï¼ŒåŒ…å«äº†æ‰€æœ‰å¯ä»¥å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡ã€‚**â‘¡**JobManagerä¼šå‘èµ„æºç®¡ç†å™¨ï¼ˆResourceManagerï¼‰è¯·æ±‚æ‰§è¡Œä»»åŠ¡å¿…è¦çš„èµ„æºï¼Œä¹Ÿå°±æ˜¯ä»»åŠ¡ç®¡ç†å™¨ï¼ˆTaskManagerï¼‰ä¸Šçš„æ’æ§½ï¼ˆslotï¼‰ã€‚**â‘¢**ä¸€æ—¦å®ƒè·å–åˆ°äº†è¶³å¤Ÿçš„èµ„æºï¼Œå°±ä¼šå°†æ‰§è¡Œå›¾åˆ†å‘åˆ°çœŸæ­£è¿è¡Œå®ƒä»¬çš„TaskManagerä¸Šã€‚**â‘£**è€Œåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒJobManagerä¼šè´Ÿè´£æ‰€æœ‰éœ€è¦ä¸­å¤®åè°ƒçš„æ“ä½œï¼Œæ¯”å¦‚è¯´æ£€æŸ¥ç‚¹ï¼ˆcheckpointsï¼‰çš„åè°ƒã€‚
- èµ„æºç®¡ç†å™¨ï¼ˆResourceManagerï¼‰ï¼šä¸»è¦è´Ÿè´£ç®¡ç†ä»»åŠ¡ç®¡ç†å™¨ï¼ˆTaskManagerï¼‰çš„æ’æ§½ï¼ˆslotï¼‰ï¼ŒTaskMangeræ’æ§½æ˜¯Flinkä¸­å®šä¹‰çš„å¤„ç†èµ„æºå•å…ƒã€‚Flinkä¸ºä¸åŒçš„ç¯å¢ƒå’Œèµ„æºç®¡ç†å·¥å…·æä¾›äº†ä¸åŒèµ„æºç®¡ç†å™¨ï¼Œæ¯”å¦‚YARNã€Mesosã€K8sï¼Œä»¥åŠstandaloneéƒ¨ç½²ã€‚**â‘ **å½“JobManagerç”³è¯·æ’æ§½èµ„æºæ—¶ï¼ŒResourceManagerä¼šå°†æœ‰ç©ºé—²æ’æ§½çš„TaskManageråˆ†é…ç»™JobManagerã€‚**â‘¡**å¦‚æœResourceManageræ²¡æœ‰è¶³å¤Ÿçš„æ’æ§½æ¥æ»¡è¶³JobManagerçš„è¯·æ±‚ï¼Œå®ƒè¿˜å¯ä»¥å‘èµ„æºæä¾›å¹³å°å‘èµ·ä¼šè¯ï¼Œä»¥æä¾›å¯åŠ¨TaskManagerè¿›ç¨‹çš„å®¹å™¨ã€‚**â‘¢**å¦å¤–ï¼ŒResourceManagerè¿˜è´Ÿè´£ç»ˆæ­¢ç©ºé—²çš„TaskManagerï¼Œé‡Šæ”¾è®¡ç®—èµ„æºã€‚
- ä»»åŠ¡ç®¡ç†å™¨ï¼ˆTaskManagerï¼‰ï¼šFlinkä¸­çš„å·¥ä½œè¿›ç¨‹ã€‚é€šå¸¸åœ¨Flinkä¸­ä¼šæœ‰å¤šä¸ªTaskManagerè¿è¡Œï¼Œæ¯ä¸€ä¸ªTaskManageréƒ½åŒ…å«äº†ä¸€å®šæ•°é‡çš„æ’æ§½ï¼ˆslotsï¼‰ã€‚æ’æ§½çš„æ•°é‡é™åˆ¶äº†TaskManagerèƒ½å¤Ÿæ‰§è¡Œçš„ä»»åŠ¡æ•°é‡ã€‚**â‘ **å¯åŠ¨ä¹‹åï¼ŒTaskManagerä¼šå‘èµ„æºç®¡ç†å™¨æ³¨å†Œå®ƒçš„æ’æ§½ï¼›**â‘¡**æ”¶åˆ°èµ„æºç®¡ç†å™¨çš„æŒ‡ä»¤åï¼ŒTaskManagerå°±ä¼šå°†ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ’æ§½æä¾›ç»™JobManagerè°ƒç”¨ã€‚JobManagerå°±å¯ä»¥å‘æ’æ§½åˆ†é…ä»»åŠ¡ï¼ˆtasksï¼‰æ¥æ‰§è¡Œäº†ã€‚**â‘¢**åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªTaskManagerå¯ä»¥è·Ÿå…¶å®ƒè¿è¡ŒåŒä¸€åº”ç”¨ç¨‹åºçš„TaskManagerä»¥æµçš„å½¢å¼è¿›è¡Œæ•°æ®çš„ä¼ è¾“ã€‚
- åˆ†å‘å™¨ï¼ˆDispatcherï¼‰ï¼š**â‘ **å¯ä»¥è·¨ä½œä¸šè¿è¡Œï¼Œå®ƒä¸ºåº”ç”¨æäº¤æä¾›äº†RESTæ¥å£ã€‚å½“ä¸€ä¸ªåº”ç”¨è¢«æäº¤æ‰§è¡Œæ—¶ï¼Œåˆ†å‘å™¨å°±ä¼šå¯åŠ¨å¹¶å°†åº”ç”¨ç§»äº¤ç»™ä¸€ä¸ªJobManagerã€‚ç”±äºæ˜¯RESTæ¥å£ï¼Œæ‰€ä»¥Dispatcherå¯ä»¥ä½œä¸ºé›†ç¾¤çš„ä¸€ä¸ªHTTPæ¥å…¥ç‚¹ï¼Œè¿™æ ·å°±èƒ½å¤Ÿä¸å—é˜²ç«å¢™é˜»æŒ¡ã€‚**â‘¡**Dispatcherä¹Ÿä¼šå¯åŠ¨ä¸€ä¸ªWeb UIï¼Œç”¨æ¥æ–¹ä¾¿åœ°å±•ç¤ºå’Œç›‘æ§ä½œä¸šæ‰§è¡Œçš„ä¿¡æ¯ã€‚Dispatcheråœ¨æ¶æ„ä¸­å¯èƒ½å¹¶ä¸æ˜¯å¿…éœ€çš„ï¼Œè¿™å–å†³äºåº”ç”¨æäº¤è¿è¡Œçš„æ–¹å¼ã€‚


<p>##5.1 ä»»åŠ¡æäº¤æµç¨‹</p>
<h3 id="5-1-1-Flinkçš„å•æœºæ¨¡å¼ä»»åŠ¡æäº¤æµç¨‹"><a href="#5-1-1-Flinkçš„å•æœºæ¨¡å¼ä»»åŠ¡æäº¤æµç¨‹" class="headerlink" title="5.1.1 Flinkçš„å•æœºæ¨¡å¼ä»»åŠ¡æäº¤æµç¨‹"></a>5.1.1 Flinkçš„å•æœºæ¨¡å¼ä»»åŠ¡æäº¤æµç¨‹</h3><p><img src="/Flink-1-13-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E9%83%A8%E7%BD%B2.assets%5C34dacf8532674812844447e527b8e432.png" alt="image.png"></p>
<ol>
<li>Dispatcheræä¾›äº†restfulé£æ ¼çš„æ¥å£ç”¨äºæäº¤ä»»åŠ¡ï¼›</li>
<li>JobManageråˆ†æä»»åŠ¡ç”Ÿæˆæ‰§è¡Œå›¾ï¼Œç„¶åå‘ResourceManagerç”³è¯·slotèµ„æºï¼›</li>
<li>ResourceManagerå¯åŠ¨TaskManagerï¼ŒTaskManageråœ¨å¯åŠ¨ä¼šå‘ResourceManagerè¿›è¡Œæ³¨å†Œslotï¼›</li>
<li>JobManageræäº¤è¦åœ¨slotä¸­æ‰§è¡Œçš„ä»»åŠ¡ã€‚</li>
</ol>
<p>##5.1.2 Yarnçš„Per-Job-Clusteræ¨¡å¼ä¸‹çš„ä»»åŠ¡æäº¤æµç¨‹<br><img src="/Flink-1-13-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E9%83%A8%E7%BD%B2.assets%5C71b36fcebf734777a47c81e63488bc1a.png" alt="image.png"></p>
<p><strong>æµç¨‹æ¦‚è¿°ï¼š</strong><br>æäº¤Jobè¯·æ±‚åç”±Yarnå¯åŠ¨æ‰€éœ€èµ„æºæ•°é‡çš„å®¹å™¨ï¼Œå®¹å™¨ä¸­å¯åŠ¨çš„TaskManagerèŠ‚ç‚¹å‘ResourceManagerè¿›è¡Œslotsçš„æ³¨å†Œï¼Œç„¶åJobManagerå‘slotsåˆ†å‘ä»»åŠ¡æ‰§è¡Œã€‚<br><code>ç›¸å½“äºæ¯æ¬¡æäº¤Jobåéƒ½å¯åŠ¨ä¸€ä¸ªFlinkçš„TaskManageré›†ç¾¤è¿›è¡Œå¤„ç†ã€‚</code></p>
<p><strong>æµç¨‹è¯¦æƒ…ï¼š</strong></p>
<ol>
<li>æäº¤JOBåï¼Œå°†JARåŒ…å’Œé…ç½®ä¸Šä¼ åˆ°HDFSï¼Œä¹‹åå‘YARNçš„ResourceManageræäº¤ä»»åŠ¡ï¼›</li>
<li>RMé€šçŸ¥NodeManagerå¯åŠ¨AMï¼ŒAMå¯åŠ¨ååŠ è½½Flinkçš„JaråŒ…å’Œé…ç½®æ„å»ºç¯å¢ƒï¼Œç„¶åå¯åŠ¨JobManagerå’ŒFlinkçš„ResourceManagerï¼›</li>
<li>åœ¨JobManagerä¸­è¿›è¡Œä»»åŠ¡åˆ‡åˆ†ï¼Œç„¶åå‘Flinkçš„ResourceManagerè¿›è¡Œä»»åŠ¡è¯·æ±‚ï¼Œå†å‘Yarnçš„ResourceManagerè¿›è¡Œèµ„æºç”³è¯·ï¼›</li>
<li>Yarnçš„ResourceManageræ ¹æ®è¯·æ±‚çš„èµ„æºæ•°å¯åŠ¨NodeManagerï¼Œç„¶ååœ¨å®¹å™¨ä¸­å¯åŠ¨TaskManagerï¼›</li>
<li>TaskManagerå‘Flinkçš„ResourceManagerè¿›è¡Œslotsèµ„æºæ³¨å†Œ(å‘é€å¿ƒè·³)ï¼Œç„¶åç”±Flinkçš„JobManagerè¿›è¡Œä»»åŠ¡åˆ†é…ã€‚</li>
</ol>
<p>###5.2 TaskManagerå’ŒSlot<br><strong>ä¸¤è€…å…³ç³»</strong></p>
<ul>
<li>ä¸€ä¸ªTaskManagerè‡³å°‘æœ‰ä¸€ä¸ªSlotï¼Œæœ‰å¤šå°‘ä¸ªslotå¯ä»¥æ¥æ”¶å¤šå°‘ä¸ªä»»åŠ¡ã€‚</li>
<li>Slotæ‹¥æœ‰ç‹¬ç«‹çš„å†…å­˜ï¼Œè€Œä¸æ˜¯ç‹¬ç«‹çš„cpuã€‚å¯ä»¥ç†è§£ä¸ºFlinkä¸­æ¯ä¸€ä¸ªTaskManageréƒ½æ˜¯ä¸€ä¸ªJVMè¿›ç¨‹ï¼Œå®ƒä¼šåœ¨ç‹¬ç«‹çš„çº¿ç¨‹ä¸Šæ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªå­ä»»åŠ¡ã€‚</li>
<li>Task Slotæ˜¯é™æ€çš„æ¦‚å¿µï¼Œæ˜¯æŒ‡TaskManagerå…·æœ‰çš„å¹¶å‘æ‰§è¡Œèƒ½åŠ›ï¼Œå¯ä»¥é€šè¿‡å‚æ•°<code>taskmanager.numberOfTaskSlots</code>è¿›è¡Œé…ç½®ï¼›è€Œå¹¶è¡Œåº¦parallelismæ˜¯åŠ¨æ€æ¦‚å¿µï¼Œå³TaskManagerè¿è¡Œç¨‹åºæ—¶å®é™…ä½¿ç”¨çš„å¹¶å‘èƒ½åŠ›ï¼Œå¯ä»¥é€šè¿‡å‚æ•°<code>parallelism.default</code>è¿›è¡Œé…ç½®ã€‚<br>![image.png](Flink-1-13-åŸºæœ¬æ¦‚å¿µå’Œéƒ¨ç½².assetsde23a1d3fda4ac1a1d0a1078179048c.png)</li>
</ul>
<p><strong>ä»»åŠ¡åˆ†é…</strong></p>
<ul>
<li>å¹¶ä¸æ˜¯æ¯ä¸ªç®—å­çš„ä»»åŠ¡éƒ½ä¼šæ”¾åˆ°ä¸åŒçš„Slotä¸­ï¼Œè€Œæ˜¯åŒä¸€ä¸ªä»»åŠ¡ä¼šæ ¹æ®å¹¶å‘åˆ†é…åˆ°ä¸åŒçš„Slotä¸­ï¼Œè€Œä¸åŒä»»åŠ¡ä¼šåˆ†é…åˆ°åŒä¸€ä¸ªSlotä¸­ï¼Œæ‰€ä»¥å¯èƒ½ä¼šæœ‰slotä¼šä¿å­˜ä¸€ä¸ªpipeline(å³åŒ…å«äº†æ‰€æœ‰çš„ç®—å­ä»»åŠ¡)ã€‚å¥½å¤„æ˜¯å¦‚æœç®—å­å·¥ä½œé‡ä¸åŒï¼Œä¸ä¼šå¯¼è‡´æŸäº›Sloté—²ç½®ï¼Œå¯ä»¥åŠ¨æ€åˆ†é…ä»»åŠ¡é‡ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨å¤šæ ¸CPUå¹¶å‘ï¼‰ã€‚</li>
<li>å› æ­¤æ‰€éœ€Slotçš„æœ€å¤§æ•°é‡å°±æ˜¯ä»»åŠ¡æœ€å¤§å¹¶è¡Œåº¦çš„å€¼ã€‚</li>
</ul>
<p><img src="/Flink-1-13-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E9%83%A8%E7%BD%B2.assets%5C63a3c09a02ce40cc8a9eae345059b374.png" alt="image.png"></p>
<h2 id="5-3-ç¨‹åºä¸æ•°æ®æµ"><a href="#5-3-ç¨‹åºä¸æ•°æ®æµ" class="headerlink" title="5.3 ç¨‹åºä¸æ•°æ®æµ"></a>5.3 ç¨‹åºä¸æ•°æ®æµ</h2><p>&amp;ensp;&amp;ensp;æ‰€æœ‰çš„Flinkç¨‹åºéƒ½æ˜¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆçš„ï¼š  Source ã€Transformationå’ŒSinkã€‚</p>
<ul>
<li>Sourceè´Ÿè´£è¯»å–æ•°æ®æº</li>
<li>Transformationåˆ©ç”¨å„ç§ç®—å­è¿›è¡Œå¤„ç†åŠ å·¥</li>
<li>Sinkè´Ÿè´£è¾“å‡ºã€‚</li>
</ul>
<p>&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;åœ¨è¿è¡Œæ—¶ï¼ŒFlinkä¸Šè¿è¡Œçš„ç¨‹åºä¼šè¢«æ˜ å°„æˆâ€œé€»è¾‘æ•°æ®æµâ€ï¼ˆdataflowsï¼‰ï¼Œå®ƒåŒ…å«äº†è¿™ä¸‰éƒ¨åˆ†ã€‚æ¯ä¸€ä¸ªdataflowä»¥ä¸€ä¸ªæˆ–å¤šä¸ªsourceså¼€å§‹ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªsinksç»“æŸã€‚dataflowç±»ä¼¼äºä»»æ„çš„æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰ã€‚åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œç¨‹åºä¸­çš„è½¬æ¢è¿ç®—ï¼ˆtransformationsï¼‰è·Ÿdataflowä¸­çš„ç®—å­ï¼ˆoperatorï¼‰æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œä½†æœ‰æ—¶å€™ï¼Œä¸€ä¸ªtransformationå¯èƒ½å¯¹åº”å¤šä¸ªoperatorã€‚</p>
<h2 id="5-4-æ‰§è¡Œå›¾"><a href="#5-4-æ‰§è¡Œå›¾" class="headerlink" title="5.4 æ‰§è¡Œå›¾"></a>5.4 æ‰§è¡Œå›¾</h2><p>ç”±Flinkç¨‹åºç›´æ¥æ˜ å°„æˆçš„æ•°æ®æµå›¾æ˜¯StreamGraphï¼Œä¹Ÿè¢«ç§°ä¸ºé€»è¾‘æµå›¾ï¼Œå› ä¸ºå®ƒä»¬è¡¨ç¤ºçš„æ˜¯è®¡ç®—é€»è¾‘çš„é«˜çº§è§†å›¾ã€‚ä¸ºäº†æ‰§è¡Œä¸€ä¸ªæµå¤„ç†ç¨‹åºï¼ŒFlinkéœ€è¦å°†é€»è¾‘æµå›¾è½¬æ¢ä¸ºç‰©ç†æ•°æ®æµå›¾ï¼ˆä¹Ÿå«æ‰§è¡Œå›¾ï¼‰ï¼Œè¯¦ç»†è¯´æ˜ç¨‹åºçš„æ‰§è¡Œæ–¹å¼ã€‚<br>Flink ä¸­çš„æ‰§è¡Œå›¾å¯ä»¥åˆ†æˆå››å±‚ï¼šStreamGraph -&gt; JobGraph -&gt; ExecutionGraph -&gt; ç‰©ç†æ‰§è¡Œå›¾</p>
<ul>
<li><strong>StreamGraphï¼š</strong>æ˜¯æ ¹æ®ç”¨æˆ·é€šè¿‡ Stream API ç¼–å†™çš„ä»£ç ç”Ÿæˆçš„æœ€åˆçš„å›¾ã€‚ç”¨æ¥è¡¨ç¤ºç¨‹åºçš„æ‹“æ‰‘ç»“æ„ã€‚</li>
<li><strong>JobGraphï¼š</strong>StreamGraphç»è¿‡ä¼˜åŒ–åç”Ÿæˆäº† JobGraphï¼Œæäº¤ç»™ JobManager çš„æ•°æ®ç»“æ„ã€‚ä¸»è¦çš„ä¼˜åŒ–ä¸ºï¼Œå°†å¤šä¸ªç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹ chain åœ¨ä¸€èµ·ä½œä¸ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ ·å¯ä»¥å‡å°‘æ•°æ®åœ¨èŠ‚ç‚¹ä¹‹é—´æµåŠ¨æ‰€éœ€è¦çš„åºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–&#x2F;ä¼ è¾“æ¶ˆè€—ã€‚</li>
<li><strong>ExecutionGraphï¼š</strong>JobManager æ ¹æ® JobGraph ç”ŸæˆExecutionGraphã€‚ExecutionGraphæ˜¯JobGraphçš„å¹¶è¡ŒåŒ–ç‰ˆæœ¬ï¼Œæ˜¯è°ƒåº¦å±‚æœ€æ ¸å¿ƒçš„æ•°æ®ç»“æ„ã€‚</li>
<li><strong>ç‰©ç†æ‰§è¡Œå›¾ï¼š</strong>JobManager æ ¹æ® ExecutionGraph å¯¹ Job è¿›è¡Œè°ƒåº¦åï¼Œåœ¨å„ä¸ªTaskManager ä¸Šéƒ¨ç½² Task åå½¢æˆçš„â€œå›¾â€ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„æ•°æ®ç»“æ„ã€‚</li>
</ul>
<p>![image.png](Flink-1-13-åŸºæœ¬æ¦‚å¿µå’Œéƒ¨ç½².assets</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="http://example.com">CJ</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://example.com/2023/05/06/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%97%B6/Flink-1-13-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E9%83%A8%E7%BD%B2/">http://example.com/2023/05/06/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%97%B6/Flink-1-13-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E9%83%A8%E7%BD%B2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="http://example.com" target="_blank">Hexo</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/05/06/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%97%B6/Flink-CDC/" title="Flink-CDC"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Flink-CDC</div></div></a></div><div class="next-post pull-right"><a href="/2023/05/06/%E5%90%8E%E7%AB%AF%E6%A1%86%E6%9E%B6/Netty04-%E4%BC%98%E5%8C%96%EF%BC%88%E8%BD%AC%EF%BC%89/" title="Netty04-ä¼˜åŒ–ï¼ˆè½¬ï¼‰"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">Netty04-ä¼˜åŒ–ï¼ˆè½¬ï¼‰</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">CJ</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">419</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">38</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#flatMap"><span class="toc-number">1.</span> <span class="toc-text">flatMap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Filter"><span class="toc-number">2.</span> <span class="toc-text">Filter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#KeyBy"><span class="toc-number">3.</span> <span class="toc-text">KeyBy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BB%9A%E5%8A%A8%E8%81%9A%E5%90%88%E7%AE%97%E5%AD%90-Rolling-Aggregation"><span class="toc-number">4.</span> <span class="toc-text">æ»šåŠ¨èšåˆç®—å­(Rolling Aggregation)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reduce"><span class="toc-number">5.</span> <span class="toc-text">Reduce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Split-%E5%92%8C-Select"><span class="toc-number">6.</span> <span class="toc-text">Split å’Œ Select</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Connect-%E5%92%8C-CoMap"><span class="toc-number">7.</span> <span class="toc-text">Connect å’Œ CoMap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Union"><span class="toc-number">8.</span> <span class="toc-text">Union</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-1-Flink%E7%9A%84%E5%8D%95%E6%9C%BA%E6%A8%A1%E5%BC%8F%E4%BB%BB%E5%8A%A1%E6%8F%90%E4%BA%A4%E6%B5%81%E7%A8%8B"><span class="toc-number">9.</span> <span class="toc-text">5.1.1 Flinkçš„å•æœºæ¨¡å¼ä»»åŠ¡æäº¤æµç¨‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-%E7%A8%8B%E5%BA%8F%E4%B8%8E%E6%95%B0%E6%8D%AE%E6%B5%81"><span class="toc-number"></span> <span class="toc-text">5.3 ç¨‹åºä¸æ•°æ®æµ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-%E6%89%A7%E8%A1%8C%E5%9B%BE"><span class="toc-number"></span> <span class="toc-text">5.4 æ‰§è¡Œå›¾</span></a></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/05/06/MySQL/%E6%B3%A8%E8%A7%A3@Select%E5%92%8C@Insert/" title="æ³¨è§£@Selectå’Œ@Insert">æ³¨è§£@Selectå’Œ@Insert</a><time datetime="2023-05-06T05:48:28.906Z" title="å‘è¡¨äº 2023-05-06 13:48:28">2023-05-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/05/06/%E5%90%8E%E7%AB%AF%E6%A1%86%E6%9E%B6/%E6%B3%A8%E8%A7%A3@EnableAutoConfiguration/" title="æ³¨è§£@EnableAutoConfiguration">æ³¨è§£@EnableAutoConfiguration</a><time datetime="2023-05-06T05:48:06.027Z" title="å‘è¡¨äº 2023-05-06 13:48:06">2023-05-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/05/06/%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%A6%BB%E7%BA%BF/%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%9B%86%E7%BE%A4%E7%9B%91%E6%8E%A7%E6%A1%86%E6%9E%B6/" title="å¤§æ•°æ®é›†ç¾¤ç›‘æ§æ¡†æ¶">å¤§æ•°æ®é›†ç¾¤ç›‘æ§æ¡†æ¶</a><time datetime="2023-05-06T05:42:56.298Z" title="å‘è¡¨äº 2023-05-06 13:42:56">2023-05-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/05/06/%E9%AB%98%E5%B9%B6%E5%8F%91/HashMap%E5%B9%B6%E5%8F%91%E9%97%AE%E9%A2%98%E5%8F%8AConcurrentHashMap%E5%8E%9F%E7%90%86/" title="HashMapå¹¶å‘é—®é¢˜åŠConcurrentHashMapåŸç†">HashMapå¹¶å‘é—®é¢˜åŠConcurrentHashMapåŸç†</a><time datetime="2023-05-06T05:31:21.103Z" title="å‘è¡¨äº 2023-05-06 13:31:21">2023-05-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/05/06/%E9%AB%98%E5%B9%B6%E5%8F%91/Stream%E5%8E%9F%E7%90%86/" title="StreamåŸç†">StreamåŸç†</a><time datetime="2023-05-06T05:31:21.103Z" title="å‘è¡¨äº 2023-05-06 13:31:21">2023-05-06</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By CJ</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>